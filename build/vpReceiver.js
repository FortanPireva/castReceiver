(()=>{"use strict";const e=e=>{if(!e)return"00:00";let t=Math.floor(e/3600),s=Math.floor((e-3600*t)/60),i=Math.floor(e%60);return t?t.toString().padStart(2,"0")+":"+s.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0"):s.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")};function t(t,s){let i=new class{constructor(t,s){this.context=null,this.playerManager=null,this.castDebugLogger=null,this.appId=s.appId,this.video=document.querySelector(t),this.playbackConfig=null,this.controls=null,this.hls=null,this.videoObject={},this.videoContainer=this.video.parentElement,this.playbackRate=1,this.autoplay=!1,this.receiverControls=new class{constructor(t){this.seekbar=new class{constructor(e){this.element=document.querySelector(e),this.castdebugger=null,this.show=!1}setCastDebugger(e){this.castdebugger=e}setProgress(e,t){this.element.style.width=e/t*100+"%"}showHide(e){this.castdebugger.debug("showHide",`${e} ${this.show}`),this.show?this.element.parentElement.style.display="block":setTimeout((()=>{this.element.parentElement.style.display="none"}),e)}}(".seekbar-progress"),this.timer=new class{constructor(e){this.element=document.querySelector(e),this.element.textContent="00:00 / 00:00"}update(t,s){this.element.textContent=`${e(t)} /${e(s)}`}}(".timer"),this.castDebugger=null,this.element=document.querySelector(t),this.show=!0,this.loader=document.querySelector(".loader"),this.playIcon=document.querySelector(".vp-icon-play"),this.pauseIcon=document.querySelector(".vp-icon-pause")}setCastDebugger(e){this.castDebugger=e,this.seekbar.setCastDebugger(this.castDebugger)}pause(){this.pauseIcon.style.display="none",this.playIcon.style.display="block",setTimeout((()=>{this.playIcon.style.display="none"}),2e3)}play(){this.playIcon.style.display="none",this.pauseIcon.style.display="block",setTimeout((()=>{this.pauseIcon.style.display="none"}),2e3)}update(e){this.seekbar.setProgress(e.currentTime,e.duration),this.timer.update(e.currentTime,e.duration)}hideControls(e){this.show=!1,this.showHide(e||5e3)}showControls(){this.show=!0,this.showHide(10)}showHide(e){this.show?this.element.style.display="flex":setTimeout((()=>{this.element.style.display="none"}),e)}}(".controls"),this.mediaManager=null,this.castReceiverManager=null,this.videoStarted=!1,this.vastService=new class{constructor(e){this.receiver=e,this.adContainer=document.querySelector(".adContainer"),this.adsDisplayContainer=null,this.adsLoader=null,this.adsDisplayInitialized=!1,this.currentAds=null,this.initialized=!1,this.autoplayAllowed=!1,this.autoplayRequiresMuted=!1}init(){window.google&&(this.initialized=!0,google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),this.adsDisplayContainer=new google.ima.AdDisplayContainer(this.adContainer,this.receiver.video),this.adsLoader=new google.ima.AdsLoader(this.adsDisplayContainer),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError,!1))}loadAds(e,t){this.currentAds={},window.google&&(this.initialized||this.init(),e?(this.currentAds.content=e,this.currentAds.type="url"):t&&(this.currentAds.content=t,this.currentAds.type="xml"),this.currentAds.currentAdIndex=0,"url"===this.currentAds.type?this.load(this.currentAds.content):this.load(null,this.currentAds.content))}onDoubleClick(e){}load(e,t){if(window.google){if(this.initialized||this.init(),this.adContainer.addEventListener("dblclick",this.onDoubleClick.bind(this)),this.adsRequest=new google.ima.AdsRequest,e)this.adsRequest.adTagUrl=e;else{if(!t)return;this.adsRequest.adsResponse=t}this.adsRequest.linearAdSlotWidth=this.receiver.video.clientWidth,this.adsRequest.linearAdSlotHeight=this.receiver.video.clientHeight,this.adsRequest.nonLinearAdSlotWidth=this.receiver.video.clientWidth,this.adsRequest.nonLinearAdSlotHeight=this.receiver.video.clientHeight/3,this.adsRequest.setAdWillAutoPlay(this.autoplayAllowed),this.adsRequest.setAdWillPlayMuted(this.autoplayRequiresMuted),this.adsRequest.vastLoadTimeout=8e3,this.adsLoader.requestAds(this.adsRequest)}}onAdsManagerLoaded(e){this.adsManager&&this.adsManager.destroy();const t=new google.ima.AdsRenderingSettings;this.adsManager=e.getAdsManager(this.receiver.video,t),this.playAds()}playAds(){this.adsDisplayInitialized||(this.adsDisplayContainer.initialize(),this.adsDisplayInitialized=!0);const e=this.receiver.video.clientWidth,t=this.receiver.video.clientHeight;try{this.adsManager.init(e,t,google.ima.ViewMode.FULLSCREEN),this.adsManager.start(),this.receiver.receiverControls.loader.style.display="none"}catch(e){console.log("AdsManager could not be started",e)}}onAdError(){}}(this)}start(){this.receiverControls.loader.style.display="none",this.onPlay()}onPlay(){this.video.play().then((()=>{this.videoStarted?this.receiverControls.play():(this.receiverControls.showControls(),this.videoStarted=!0),this.receiverControls.hideControls(6e3)})).catch((()=>{}))}onPause(){this.video.pause(),this.receiverControls.pause(),this.receiverControls.showControls()}addPlayerEvents(){this.video.addEventListener("timeupdate",this.onTimeUpdate)}onTimeUpdate(){this.receiverControls.update(this.updatePlayerState())}updatePlayerState(){return{currentTime:this.video.currentTime,duration:this.videoObject.duration}}attachMedia(){if(vpReceiver.HLSsupported=Hls.isSupported(),this.castDebugLogger.debug("inside attach media",vpReceiver.HLSsupported),this.video.playbackRate=1,this.castDebugLogger.debug("video file",JSON.stringify(this.video,["id","className","tagName"])),this.videoObject.file.endsWith("mp4"))this.castDebugLogger.debug("inside mp4",this.videoObject.file),this.video.src=this.videoObject.file,this.start();else if(vpReceiver.HLSsupported){this.castDebugLogger.debug("inside hlssupported",this.videoObject.file);try{this.hls=new Hls,this.castDebugLogger.debug("hls initialized",this.videoObject.file),this.currentTime>0&&(this.video.currentTime=this.currentTime),this.hls.attachMedia(this.video),this.castDebugLogger.debug("attached media",this.videoObject.file),this.hls.on(Hls.Events.MEDIA_ATTACHED,(()=>{this.castDebugLogger.debug("amedia attached",this.videoObject.file),this.hls.startLevel=0,this.castDebugLogger.debug("loading source hlssupported",this.videoObject.file),this.hls.loadSource(this.videoObject.file)})),this.hls.on(Hls.Events.MANIFEST_PARSED,((e,t)=>{this.hls.currentLevel=3,this.start()})),this.hls.on(Hls.Events.ERROR,((e,t)=>{this.castDebugLogger.debug("HLS  ERROR",t.details)}))}catch(e){this.castDebugLogger.debug("hls error",e)}}this.castDebugLogger.debug("finished attach media")}fakeinit(){this.castDebugLogger={debug:function(e,t){console.debug(e,t)}},this.receiverControls.setCastDebugger(this.castDebugLogger),this.videoObject.file="https://vp.gjirafa.net/vps/prod/odgehtyo/encode/vjsmylds/mp4/360p.mp4",this.vastService.loadAds("https://vp-dev.gjirafa.net/vps/content/vast/preroll-2.xml"),this.bindMethods(),this.addPlayerEvents()}init(){this.context=cast.framework.CastReceiverContext.getInstance(),this.context.setLoggerLevel(cast.framework.LoggerLevel.DEBUG),this.playerManager=this.context.getPlayerManager(),this.playerManager.setMediaElement(this.video),this.castDebugLogger=cast.debug.CastDebugLogger.getInstance(),this.castDebugLogger.setEnabled(!0),this.castDebugLogger.debug("hello","okej"),this.receiverControls.setCastDebugger(this.castDebugLogger),this.context.start(),this.bindMethods(),this.bindInterceptors(),this.addPlayerEvents()}onSeek(e){this.video.currentTime=e.currentTime,this.receiverControls.showControls(),this.receiverControls.hideControls(6e3),this.receiverControls.update(this.updatePlayerState())}drawButtons(){this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_1,cast.framework.ui.ControlsButton.QUEUE_PREV),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_1,cast.framework.ui.ControlsButton.CAPTIONS),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_2,cast.framework.ui.ControlsButton.SEEK_FORWARD_15),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_2,cast.framework.ui.ControlsButton.QUEUE_NEXT)}bindInterceptors(){this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD,this.onLoadRequest.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PLAY,this.onPlay.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PAUSE,this.onPause.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.SEEK,this.onSeek.bind(this))}bindMethods(){this.bindInterceptors=this.bindInterceptors.bind(this),this.onLoadRequest=this.onLoadRequest.bind(this),this.attachMedia=this.attachMedia.bind(this),this.start=this.start.bind(this),this.addPlayerEvents=this.addPlayerEvents.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onPlay=this.onPlay.bind(this),this.onPause=this.onPause.bind(this),this.updatePlayerState=this.updatePlayerState.bind(this)}onLoadRequest(e){return this.castDebugLogger.debug("VPreceiver",e.media.contentId),this.castDebugLogger.debug("VPreceiver1",Hls.isSupported()),this.videoObject.file=e.media.contentId,this.videoObject.duration=e.media.metadata.duration,this.currentTime=e.currentTime,this.playbackRate=e.playbackRate,this.autoplay=e.autoplay,e.vastUrl||e.vastXml?this.vastService.loadAds(e.vastUrl,e.vastXml):this.attachMedia(),null}addBreaks(e){return castDebugLogger.debug(LOG_RECEIVER_TAG,"addBreaks: "+JSON.stringify(e)),fetchMediaById("fbb_ad").then((t=>{e.breakClips=[{id:"fbb_ad",title:t.title,contentUrl:t.stream.dash,contentType:"application/dash+xml",whenSkippable:5}],e.breaks=[{id:"pre-roll",breakClipIds:["fbb_ad"],position:0}]}))}fetchMediaById(e){return castDebugLogger.debug(LOG_RECEIVER_TAG,"fetching id: "+e),new Promise(((t,s)=>{fetch(CONTENT_URL).then((e=>e.json())).then((i=>{i?i[e]?t(i[e]):s(`${e} not found in repository`):s("Content repository not found.")}))}))}}(t,s);return i.init(),i}t.HLSsupported=!1,window.vpReceiver=t})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBT0MsS0FDekJDLFlBQWEsdUJBQ2JDLGNBQWUsSUFJbkJWLEVBQWlCVyxPQUFTLENBQ3hCLENBQ0V4TSxHQUFJLFdBQ0p5TSxhQUFjLENBQUMsVUFDZkMsU0FBVSxPQUtsQlgsZUFBZS9MLEdBR2IsT0FGQU8sZ0JBQWdCeUIsTUFBTThKLGlCQUFrQixnQkFBa0I5TCxHQUVuRCxJQUFJMk0sU0FBUSxDQUFDQyxFQUFRQyxLQUMxQkMsTUFBTUMsYUFDSHZGLE1BQU13RixHQUFhQSxFQUFTQyxTQUM1QnpGLE1BQU0wRixJQUNEQSxFQUNFQSxFQUFJbE4sR0FDTjRNLEVBQU9NLEVBQUlsTixJQUVYNk0sRUFBUSxHQUFFN00sNkJBR1o2TSxFQUFPLHlDRHJZVzdNLEVBQUlDLEdBRWhDLE9BREFDLEVBQVMyRCxPQUNGM0QsRUFMVEgsRUFBV2dJLGNBQWUsRUFRMUJqRSxPQUFPL0QsV0FBYUEsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL21vZGVscy9zZWVrYmFyLmpzIiwid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL2hlbHBlcnMvVXRpbHMuanMiLCJ3ZWJwYWNrOi8vdnAtcmVjZWl2ZXIvLi9zcmMvanMvdnBSZWNlaXZlci5qcyIsIndlYnBhY2s6Ly92cC1yZWNlaXZlci8uL3NyYy9qcy9tb2RlbHMvcmVjZWl2ZXIuanMiLCJ3ZWJwYWNrOi8vdnAtcmVjZWl2ZXIvLi9zcmMvanMvbW9kZWxzL3JlY2VpdmVyLWNvbnRyb2xzLmpzIiwid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL21vZGVscy90aW1lci5qcyIsIndlYnBhY2s6Ly92cC1yZWNlaXZlci8uL3NyYy9qcy9tb2RlbHMvdmFzdFNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgU2Vla0JhciB7XHJcbiAgY29uc3RydWN0b3IoaWQpIHtcclxuICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5jYXN0ZGVidWdnZXIgPSBudWxsO1xyXG4gICAgdGhpcy5zaG93ID0gZmFsc2U7XHJcbiAgfVxyXG4gIHNldENhc3REZWJ1Z2dlcihjYXN0ZGVidWdnZXIpIHtcclxuICAgIHRoaXMuY2FzdGRlYnVnZ2VyID0gY2FzdGRlYnVnZ2VyO1xyXG4gIH1cclxuICBzZXRQcm9ncmVzcyh0aW1lLCBkdXJhdGlvbikge1xyXG4gICAgLy8gdGhpcy5jYXN0ZGVidWdnZXIuZGVidWcoXCJlbGVcIiwgSlNPTi5zdHJpbmdpZnkodGhpcy5lbGVtZW50KSk7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSAodGltZSAvIGR1cmF0aW9uKSAqIDEwMCArIFwiJVwiO1xyXG4gICAgLy8gdGhpcy5jYXN0ZGVidWdnZXIuZGVidWcoXCJ3aWR0aFwiLCB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGgpO1xyXG4gIH1cclxuXHJcbiAgc2hvd0hpZGUodGltaW5nKSB7XHJcbiAgICB0aGlzLmNhc3RkZWJ1Z2dlci5kZWJ1ZyhcInNob3dIaWRlXCIsIGAke3RpbWluZ30gJHt0aGlzLnNob3d9YCk7XHJcbiAgICBpZiAodGhpcy5zaG93KSB7XHJcbiAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnRFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgIH0sIHRpbWluZyk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZWVrQmFyO1xyXG4iLCJjb25zdCBmb3JtYXRUaW1lID0gKHRpbWUpID0+IHtcclxuICBpZiAoIXRpbWUpIHJldHVybiBcIjAwOjAwXCI7XHJcblxyXG4gIGxldCBob3VycyA9IE1hdGguZmxvb3IodGltZSAvIDM2MDApO1xyXG4gIGxldCBtaW51dGVzID0gTWF0aC5mbG9vcigodGltZSAtIGhvdXJzICogMzYwMCkgLyA2MCk7XHJcbiAgbGV0IHNlY29uZHMgPSBNYXRoLmZsb29yKHRpbWUgJSA2MCk7XHJcblxyXG4gIC8vIGZvcm1hdCB0aGUgbWludXRlcyBhbmQgc2Vjb25kcyBzdHJpbmcgdG8gbG9vayBjb25zaXN0ZW50IGFjcm9zcyBhbGwgdmFsdWVzXHJcbiAgaWYgKCFob3Vycykge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgbWludXRlcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKSArXHJcbiAgICAgIFwiOlwiICtcclxuICAgICAgc2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiAoXHJcbiAgICBob3Vycy50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKSArXHJcbiAgICBcIjpcIiArXHJcbiAgICBtaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpICtcclxuICAgIFwiOlwiICtcclxuICAgIHNlY29uZHMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIilcclxuICApO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gIGZvcm1hdFRpbWUsXHJcbn07XHJcbiIsImltcG9ydCBSZWNlaXZlciBmcm9tIFwiLi9tb2RlbHMvcmVjZWl2ZXJcIjtcclxuXHJcbi8vYSBib29sZWFuIHRlbGxpbmcgd2hldGhlciBITFMgaXMgc3VwcG9ydGVkIGluIHRoZSBicm93c2VyXHJcbnZwUmVjZWl2ZXIuSExTc3VwcG9ydGVkID0gZmFsc2U7XHJcblxyXG5mdW5jdGlvbiB2cFJlY2VpdmVyKGlkLCBjb25maWcpIHtcclxuICBsZXQgcmVjZWl2ZXIgPSBuZXcgUmVjZWl2ZXIoaWQsIGNvbmZpZyk7XHJcbiAgcmVjZWl2ZXIuaW5pdCgpO1xyXG4gIHJldHVybiByZWNlaXZlcjtcclxufVxyXG5cclxud2luZG93LnZwUmVjZWl2ZXIgPSB2cFJlY2VpdmVyO1xyXG4iLCJpbXBvcnQgaGxzY29uZmlnIGZyb20gXCIuLi9jb25maWcvaGxzQ29uZmlnXCI7XHJcbmltcG9ydCBSZWNlaXZlckNvbnRyb2xzIGZyb20gXCIuL3JlY2VpdmVyLWNvbnRyb2xzXCI7XHJcbmltcG9ydCBWYXN0U2VydmljZSBmcm9tIFwiLi92YXN0U2VydmljZVwiO1xyXG5jbGFzcyBSZWNlaXZlciB7XHJcbiAgY29uc3RydWN0b3IoaWQsIGNvbmZpZykge1xyXG4gICAgdGhpcy5jb250ZXh0ID0gbnVsbDtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlciA9IG51bGw7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlciA9IG51bGw7XHJcbiAgICB0aGlzLmFwcElkID0gY29uZmlnLmFwcElkO1xyXG4gICAgdGhpcy52aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5wbGF5YmFja0NvbmZpZyA9IG51bGw7XHJcbiAgICB0aGlzLmNvbnRyb2xzID0gbnVsbDtcclxuICAgIHRoaXMuaGxzID0gbnVsbDtcclxuICAgIHRoaXMudmlkZW9PYmplY3QgPSB7fTtcclxuICAgIHRoaXMudmlkZW9Db250YWluZXIgPSB0aGlzLnZpZGVvLnBhcmVudEVsZW1lbnQ7XHJcbiAgICB0aGlzLnBsYXliYWNrUmF0ZSA9IDE7XHJcbiAgICB0aGlzLmF1dG9wbGF5ID0gZmFsc2U7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMgPSBuZXcgUmVjZWl2ZXJDb250cm9scyhcIi5jb250cm9sc1wiKTtcclxuICAgIHRoaXMubWVkaWFNYW5hZ2VyID0gbnVsbDtcclxuICAgIHRoaXMuY2FzdFJlY2VpdmVyTWFuYWdlciA9IG51bGw7XHJcbiAgICB0aGlzLnZpZGVvU3RhcnRlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy52YXN0U2VydmljZSA9IG5ldyBWYXN0U2VydmljZSh0aGlzKTtcclxuICB9XHJcbiAgc3RhcnQoKSB7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMubG9hZGVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIHRoaXMub25QbGF5KCk7XHJcbiAgfVxyXG5cclxuICBvblBsYXkoKSB7XHJcbiAgICAvLyByZXR1cm4gdGhpcy5wbGF5ZXJNYW5hZ2VyLnBsYXkoKTtcclxuICAgIHRoaXMudmlkZW9cclxuICAgICAgLnBsYXkoKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnZpZGVvU3RhcnRlZCkge1xyXG4gICAgICAgICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzLnNob3dDb250cm9scygpO1xyXG4gICAgICAgICAgdGhpcy52aWRlb1N0YXJ0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMucGxheSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuaGlkZUNvbnRyb2xzKDYwMDApO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKCkgPT4ge30pO1xyXG4gIH1cclxuICBvblBhdXNlKCkge1xyXG4gICAgdGhpcy52aWRlby5wYXVzZSgpO1xyXG4gICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzLnBhdXNlKCk7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuc2hvd0NvbnRyb2xzKCk7XHJcbiAgfVxyXG4gIGFkZFBsYXllckV2ZW50cygpIHtcclxuICAgIHRoaXMudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgdGhpcy5vblRpbWVVcGRhdGUpO1xyXG4gIH1cclxuICBvblRpbWVVcGRhdGUoKSB7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMudXBkYXRlKHRoaXMudXBkYXRlUGxheWVyU3RhdGUoKSk7XHJcbiAgfVxyXG4gIHVwZGF0ZVBsYXllclN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY3VycmVudFRpbWU6IHRoaXMudmlkZW8uY3VycmVudFRpbWUsXHJcbiAgICAgIGR1cmF0aW9uOiB0aGlzLnZpZGVvT2JqZWN0LmR1cmF0aW9uLFxyXG4gICAgfTtcclxuICB9XHJcbiAgYXR0YWNoTWVkaWEoKSB7XHJcbiAgICB2cFJlY2VpdmVyLkhMU3N1cHBvcnRlZCA9IEhscy5pc1N1cHBvcnRlZCgpO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJpbnNpZGUgYXR0YWNoIG1lZGlhXCIsIHZwUmVjZWl2ZXIuSExTc3VwcG9ydGVkKTtcclxuICAgIHRoaXMudmlkZW8ucGxheWJhY2tSYXRlID0gMTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICBcInZpZGVvIGZpbGVcIixcclxuICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy52aWRlbywgW1wiaWRcIiwgXCJjbGFzc05hbWVcIiwgXCJ0YWdOYW1lXCJdKVxyXG4gICAgKTtcclxuICAgIGlmICh0aGlzLnZpZGVvT2JqZWN0LmZpbGUuZW5kc1dpdGgoXCJtcDRcIikpIHtcclxuICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJpbnNpZGUgbXA0XCIsIHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcbiAgICAgIHRoaXMudmlkZW8uc3JjID0gdGhpcy52aWRlb09iamVjdC5maWxlO1xyXG4gICAgICB0aGlzLnN0YXJ0KCk7XHJcbiAgICB9IGVsc2UgaWYgKHZwUmVjZWl2ZXIuSExTc3VwcG9ydGVkKSB7XHJcbiAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaW5zaWRlIGhsc3N1cHBvcnRlZFwiLCB0aGlzLnZpZGVvT2JqZWN0LmZpbGUpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHRoaXMuaGxzID0gbmV3IEhscygpO1xyXG4gICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaGxzIGluaXRpYWxpemVkXCIsIHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFRpbWUgPiAwKSB0aGlzLnZpZGVvLmN1cnJlbnRUaW1lID0gdGhpcy5jdXJyZW50VGltZTtcclxuICAgICAgICB0aGlzLmhscy5hdHRhY2hNZWRpYSh0aGlzLnZpZGVvKTtcclxuICAgICAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcImF0dGFjaGVkIG1lZGlhXCIsIHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgdGhpcy5obHMub24oSGxzLkV2ZW50cy5NRURJQV9BVFRBQ0hFRCwgKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJhbWVkaWEgYXR0YWNoZWRcIiwgdGhpcy52aWRlb09iamVjdC5maWxlKTtcclxuICAgICAgICAgIHRoaXMuaGxzLnN0YXJ0TGV2ZWwgPSAwO1xyXG4gICAgICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXHJcbiAgICAgICAgICAgIFwibG9hZGluZyBzb3VyY2UgaGxzc3VwcG9ydGVkXCIsXHJcbiAgICAgICAgICAgIHRoaXMudmlkZW9PYmplY3QuZmlsZVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIHRoaXMuaGxzLmxvYWRTb3VyY2UodGhpcy52aWRlb09iamVjdC5maWxlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmhscy5vbihIbHMuRXZlbnRzLk1BTklGRVNUX1BBUlNFRCwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmhscy5jdXJyZW50TGV2ZWwgPSAzO1xyXG4gICAgICAgICAgdGhpcy5zdGFydCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuaGxzLm9uKEhscy5FdmVudHMuRVJST1IsIChldmVudCwgZGF0YSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJITFMgIEVSUk9SXCIsIGRhdGEuZGV0YWlscyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJobHMgZXJyb3JcIiwgZXJyb3IpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyB0aGlzLmhscy5vbihIbHMuRXZlbnRzLkVSUk9SLCAoZXZlbnQsIGRhdGEpID0+IHtcclxuICAgICAgLy8gICBpZiAoZGF0YS5kZXRhaWxzID09PSBcIm1hbmlmZXN0TG9hZEVycm9yXCIpIHtcclxuICAgICAgLy8gICAgIHRoaXMudmlkZW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuaGlkZUNvbnRlbnQpO1xyXG4gICAgICAvLyAgICAgdGhpcy52aWRlb0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNzc0NsYXNzZXMuZWZmZWN0cy5zaG93RXJyb3IpO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgaWYgKGRhdGEuZGV0YWlscyA9PT0gXCJtYW5pZmVzdExvYWRUaW1lT3V0XCIpIHtcclxuICAgICAgLy8gICAgIHRoaXMudmlkZW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuaGlkZUNvbnRlbnQpO1xyXG4gICAgICAvLyAgICAgdGhpcy52aWRlb0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNzc0NsYXNzZXMuZWZmZWN0cy5zaG93RXJyb3IpO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgaWYgKGRhdGEuZGV0YWlscyA9PT0gXCJtYW5pZmVzdFBhcnNpbmdFcnJvclwiKSB7XHJcbiAgICAgIC8vICAgICB0aGlzLnZpZGVvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLmhpZGVDb250ZW50KTtcclxuICAgICAgLy8gICAgIHRoaXMudmlkZW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuc2hvd0Vycm9yKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwibGV2ZWxMb2FkRXJyb3JcIikge1xyXG4gICAgICAvLyAgICAgdGhpcy5yZW1vdmVMZXZlbChkYXRhLmNvbnRleHQubGV2ZWwpO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgaWYgKGRhdGEuZGV0YWlscyA9PT0gXCJmcmFnTG9hZEVycm9yXCIpIHtcclxuICAgICAgLy8gICAgIHRoaXMuZnJhZ0Vycm9yQ291bnQrKztcclxuICAgICAgLy8gICAgIC8vIHNuIHJlZmVyZXMgdG8gc2VxdWVuY2UgbnVtYmVyXHJcbiAgICAgIC8vICAgICBpZiAoZGF0YS5mcmFnLnNuID09IDApIHRoaXMuZmFpbGVkVG9Mb2FkRmlyc3RGcmFnbWVudCA9IHRydWU7XHJcbiAgICAgIC8vICAgfVxyXG5cclxuICAgICAgLy8gICBpZiAodGhpcy5sZXZlbEhhc01pc3NpbmdGcmFnbWVudHMoKSkge1xyXG4gICAgICAvLyAgICAgdGhpcy5mcmFnRXJyb3JDb3VudCA9IDA7XHJcbiAgICAgIC8vICAgICB0aGlzLnJlbW92ZUxldmVsKGRhdGEuZnJhZy5sZXZlbCk7XHJcbiAgICAgIC8vICAgICB0aGlzLmhscy5sb2FkTGV2ZWwgPSAtMTtcclxuICAgICAgLy8gICAgIGNvbnNvbGUubG9nKFwiTmV0d29yayBlcnJvciBlbmNvdW50ZXJlZFwiKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmICh0aGlzLmZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQpIHtcclxuICAgICAgLy8gICAgIHRoaXMuZmFpbGVkVG9Mb2FkRmlyc3RGcmFnbWVudCA9IGZhbHNlO1xyXG4gICAgICAvLyAgICAgdGhpcy5yZW1vdmVMZXZlbChkYXRhLmZyYWcubGV2ZWwpO1xyXG4gICAgICAvLyAgICAgdGhpcy5obHMubG9hZExldmVsID0gLTE7XHJcbiAgICAgIC8vICAgICB0aGlzLm9uUGxheSgpO1xyXG4gICAgICAvLyAgICAgY29uc29sZS5sb2coXCJOZXR3b3JrIGVycm9yIGVuY291bnRlcmVkXCIpO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgaWYgKCFkYXRhLmZhdGFsKSB7XHJcbiAgICAgIC8vICAgICByZXR1cm47XHJcbiAgICAgIC8vICAgfVxyXG5cclxuICAgICAgLy8gICBzd2l0Y2ggKGRhdGEudHlwZSkge1xyXG4gICAgICAvLyAgICAgY2FzZSBIbHMuRXJyb3JUeXBlcy5ORVRXT1JLX0VSUk9SOlxyXG4gICAgICAvLyAgICAgICBjb25zb2xlLmxvZyhcImZhdGFsIG5ldHdvcmsgZXJyb3IgZW5jb3VudGVyZWRcIik7XHJcbiAgICAgIC8vICAgICAgIHRoaXMuaGxzLnN0YXJ0TG9hZCgpO1xyXG4gICAgICAvLyAgICAgICBicmVhaztcclxuICAgICAgLy8gICAgIGNhc2UgSGxzLkVycm9yVHlwZXMuTUVESUFfRVJST1I6XHJcbiAgICAgIC8vICAgICAgIGNvbnNvbGUubG9nKFwiZmF0YWwgbWVkaWEgZXJyb3IgZW5jb3VudGVyZWRcIik7XHJcbiAgICAgIC8vICAgICAgIHRoaXMuaGxzLnJlY292ZXJNZWRpYUVycm9yKCk7XHJcbiAgICAgIC8vICAgICAgIGJyZWFrO1xyXG4gICAgICAvLyAgICAgZGVmYXVsdDpcclxuICAgICAgLy8gICAgICAgdGhpcy5obHMuZGVzdHJveSgpO1xyXG4gICAgICAvLyAgICAgICBicmVhaztcclxuICAgICAgLy8gICB9XHJcbiAgICAgIC8vIH0pO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJmaW5pc2hlZCBhdHRhY2ggbWVkaWFcIik7XHJcbiAgICAvLyAgZWxzZSBpZiAodGhpcy52aWRlby5jYW5QbGF5VHlwZShcImFwcGxpY2F0aW9uL3ZuZC5hcHBsZS5tcGVndXJsXCIpKSB7XHJcbiAgICAvLyAgIHRoaXMudmlkZW8uc3JjID0gdGhpcy52aWRlb09iamVjdC5maWxlO1xyXG4gICAgLy8gICBpZiAoVXRpbHMuaXNJT1MoKSkge1xyXG4gICAgLy8gICAgIGZwc19kcm0uaW5pdChcclxuICAgIC8vICAgICAgIHRoaXMudmlkZW8sXHJcbiAgICAvLyAgICAgICBjb25maWcuZnBzQ2VydGlmaWNhdGVVcmwsXHJcbiAgICAvLyAgICAgICB0aGlzLnZpZGVvT2JqZWN0LmFzc2V0SWRcclxuICAgIC8vICAgICApO1xyXG4gICAgLy8gICB9XHJcbiAgICAvLyAgIHRoaXMudmlkZW8ucGxheXNJbmxpbmUgPSB0cnVlO1xyXG4gICAgLy8gICB0aGlzLnN0YXJ0KCk7XHJcbiAgICAvLyB9XHJcbiAgfVxyXG4gIGZha2Vpbml0KCkge1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIgPSB7XHJcbiAgICAgIGRlYnVnOiBmdW5jdGlvbiAodHlwZSwgbWVzc2FnZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZGVidWcodHlwZSwgbWVzc2FnZSk7XHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzLnNldENhc3REZWJ1Z2dlcih0aGlzLmNhc3REZWJ1Z0xvZ2dlcik7XHJcbiAgICB0aGlzLnZpZGVvT2JqZWN0LmZpbGUgPVxyXG4gICAgICBcImh0dHBzOi8vdnAuZ2ppcmFmYS5uZXQvdnBzL3Byb2Qvb2RnZWh0eW8vZW5jb2RlL3Zqc215bGRzL21wNC8zNjBwLm1wNFwiO1xyXG4gICAgdGhpcy52YXN0U2VydmljZS5sb2FkQWRzKFxyXG4gICAgICBcImh0dHBzOi8vdnAtZGV2LmdqaXJhZmEubmV0L3Zwcy9jb250ZW50L3Zhc3QvcHJlcm9sbC0yLnhtbFwiXHJcbiAgICApO1xyXG4gICAgLy8gdGhpcy5hdHRhY2hNZWRpYSgpO1xyXG4gICAgdGhpcy5iaW5kTWV0aG9kcygpO1xyXG4gICAgLy8gdGhpcy5iaW5kSW50ZXJjZXB0b3JzKCk7XHJcbiAgICB0aGlzLmFkZFBsYXllckV2ZW50cygpO1xyXG4gIH1cclxuICBpbml0KCkge1xyXG4gICAgdGhpcy5jb250ZXh0ID0gY2FzdC5mcmFtZXdvcmsuQ2FzdFJlY2VpdmVyQ29udGV4dC5nZXRJbnN0YW5jZSgpO1xyXG5cclxuICAgIHRoaXMuY29udGV4dC5zZXRMb2dnZXJMZXZlbChjYXN0LmZyYW1ld29yay5Mb2dnZXJMZXZlbC5ERUJVRyk7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIgPSB0aGlzLmNvbnRleHQuZ2V0UGxheWVyTWFuYWdlcigpO1xyXG4gICAgdGhpcy5wbGF5ZXJNYW5hZ2VyLnNldE1lZGlhRWxlbWVudCh0aGlzLnZpZGVvKTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyID0gY2FzdC5kZWJ1Zy5DYXN0RGVidWdMb2dnZXIuZ2V0SW5zdGFuY2UoKTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLnNldEVuYWJsZWQodHJ1ZSk7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcImhlbGxvXCIsIFwib2tlalwiKTtcclxuXHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuc2V0Q2FzdERlYnVnZ2VyKHRoaXMuY2FzdERlYnVnTG9nZ2VyKTtcclxuICAgIC8vIHRoaXMucGxheWJhY2tDb25maWcuYXV0b1Jlc3VtZUR1cmF0aW9uID0gNTtcclxuICAgIC8vIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmluZm8oTE9HX1JFQ0VJVkVSX1RBRywgYGF1dG9pbml0OiBgKTtcclxuICAgIC8vIHRoaXMuY29udHJvbHMuY2xlYXJEZWZhdWx0U2xvdEFzc2lnbm1lbnRzKCk7XHJcbiAgICAvLyB0aGlzLmRyYXdCdXR0b25zKCk7XHJcblxyXG4gICAgLy8gY29udGV4dC5zdGFydCh7XHJcbiAgICAvLyAgIHF1ZXVlOiBuZXcgQ2FzdFF1ZXVlKCksXHJcbiAgICAvLyAgIHBsYXliYWNrQ29uZmlnOiB0aGlzLnBsYXliYWNrQ29uZmlnLFxyXG4gICAgLy8gICBzdXBwb3J0ZWRDb21tYW5kczpcclxuICAgIC8vICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5Db21tYW5kLkFMTF9CQVNJQ19NRURJQSB8XHJcbiAgICAvLyAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuQ29tbWFuZC5RVUVVRV9QUkVWIHxcclxuICAgIC8vICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5Db21tYW5kLlFVRVVFX05FWFQgfFxyXG4gICAgLy8gICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkNvbW1hbmQuU1RSRUFNX1RSQU5TRkVSLFxyXG4gICAgLy8gfSk7XHJcbiAgICAvLyB0aGlzLmJpbmRJbnRlcmNlcHRvcnMoKTtcclxuICAgIC8vIHRoaXMudmlkZW9PYmplY3QuZmlsZSA9XHJcbiAgICAvLyAgIFwiaHR0cHM6Ly92cC5namlyYWZhLm5ldC92cHMvcHJvZC9vZGdlaHR5by9lbmNvZGUvdmpzbXlsZHMvbXA0LzM2MHAubXA0XCI7XHJcbiAgICAvLyB0aGlzLmF0dGFjaE1lZGlhKCk7XHJcbiAgICB0aGlzLmNvbnRleHQuc3RhcnQoKTtcclxuICAgIHRoaXMuYmluZE1ldGhvZHMoKTtcclxuICAgIHRoaXMuYmluZEludGVyY2VwdG9ycygpO1xyXG4gICAgdGhpcy5hZGRQbGF5ZXJFdmVudHMoKTtcclxuICB9XHJcbiAgb25TZWVrKHJlcXVlc3REYXRhKSB7XHJcbiAgICB0aGlzLnZpZGVvLmN1cnJlbnRUaW1lID0gcmVxdWVzdERhdGEuY3VycmVudFRpbWU7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuc2hvd0NvbnRyb2xzKCk7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuaGlkZUNvbnRyb2xzKDYwMDApO1xyXG5cclxuICAgIHRoaXMucmVjZWl2ZXJDb250cm9scy51cGRhdGUodGhpcy51cGRhdGVQbGF5ZXJTdGF0ZSgpKTtcclxuICB9XHJcbiAgZHJhd0J1dHRvbnMoKSB7XHJcbiAgICB0aGlzLmNvbnRyb2xzLmFzc2lnbkJ1dHRvbihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNTbG90LlNMT1RfU0VDT05EQVJZXzEsXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzQnV0dG9uLlFVRVVFX1BSRVZcclxuICAgICk7XHJcbiAgICB0aGlzLmNvbnRyb2xzLmFzc2lnbkJ1dHRvbihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNTbG90LlNMT1RfUFJJTUFSWV8xLFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc0J1dHRvbi5DQVBUSU9OU1xyXG4gICAgKTtcclxuICAgIHRoaXMuY29udHJvbHMuYXNzaWduQnV0dG9uKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc1Nsb3QuU0xPVF9QUklNQVJZXzIsXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzQnV0dG9uLlNFRUtfRk9SV0FSRF8xNVxyXG4gICAgKTtcclxuICAgIHRoaXMuY29udHJvbHMuYXNzaWduQnV0dG9uKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc1Nsb3QuU0xPVF9TRUNPTkRBUllfMixcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNCdXR0b24uUVVFVUVfTkVYVFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGJpbmRJbnRlcmNlcHRvcnMoKSB7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIuc2V0TWVzc2FnZUludGVyY2VwdG9yKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5NZXNzYWdlVHlwZS5MT0FELFxyXG4gICAgICB0aGlzLm9uTG9hZFJlcXVlc3QuYmluZCh0aGlzKVxyXG4gICAgKTtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlci5zZXRNZXNzYWdlSW50ZXJjZXB0b3IoXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLk1lc3NhZ2VUeXBlLlBMQVksXHJcbiAgICAgIHRoaXMub25QbGF5LmJpbmQodGhpcylcclxuICAgICk7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIuc2V0TWVzc2FnZUludGVyY2VwdG9yKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5NZXNzYWdlVHlwZS5QQVVTRSxcclxuICAgICAgdGhpcy5vblBhdXNlLmJpbmQodGhpcylcclxuICAgICk7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIuc2V0TWVzc2FnZUludGVyY2VwdG9yKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5NZXNzYWdlVHlwZS5TRUVLLFxyXG4gICAgICB0aGlzLm9uU2Vlay5iaW5kKHRoaXMpXHJcbiAgICApO1xyXG4gIH1cclxuICBiaW5kTWV0aG9kcygpIHtcclxuICAgIHRoaXMuYmluZEludGVyY2VwdG9ycyA9IHRoaXMuYmluZEludGVyY2VwdG9ycy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbkxvYWRSZXF1ZXN0ID0gdGhpcy5vbkxvYWRSZXF1ZXN0LmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmF0dGFjaE1lZGlhID0gdGhpcy5hdHRhY2hNZWRpYS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zdGFydCA9IHRoaXMuc3RhcnQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuYWRkUGxheWVyRXZlbnRzID0gdGhpcy5hZGRQbGF5ZXJFdmVudHMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25UaW1lVXBkYXRlID0gdGhpcy5vblRpbWVVcGRhdGUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25QbGF5ID0gdGhpcy5vblBsYXkuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25QYXVzZSA9IHRoaXMub25QYXVzZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy51cGRhdGVQbGF5ZXJTdGF0ZSA9IHRoaXMudXBkYXRlUGxheWVyU3RhdGUuYmluZCh0aGlzKTtcclxuICB9XHJcbiAgb25Mb2FkUmVxdWVzdChsb2FkUmVxdWVzdERhdGEpIHtcclxuICAgIC8vIElmIHRoZSBsb2FkUmVxdWVzdERhdGEgaXMgaW5jb21wbGV0ZSByZXR1cm4gYW4gZXJyb3IgbWVzc2FnZVxyXG4gICAgLy8gaWYgKCFsb2FkUmVxdWVzdERhdGEgfHwgIWxvYWRSZXF1ZXN0RGF0YS5tZWRpYSkge1xyXG4gICAgLy8gICBjb25zdCBlcnJvciA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvckRhdGEoXHJcbiAgICAvLyAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JUeXBlLkxPQURfRkFJTEVEXHJcbiAgICAvLyAgICk7XHJcbiAgICAvLyAgIGVycm9yLnJlYXNvbiA9IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yUmVhc29uLklOVkFMSURfUkVRVUVTVDtcclxuICAgIC8vICAgcmV0dXJuIGVycm9yO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIC8vIGNoZWNrIGFsbCBjb250ZW50IHNvdXJjZSBmaWVsZHMgZm9yIGFzc2V0IFVSTCBvciBJRFxyXG4gICAgLy8gbGV0IHNvdXJjZSA9XHJcbiAgICAvLyAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50VXJsIHx8XHJcbiAgICAvLyAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5lbnRpdHkgfHxcclxuICAgIC8vICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRJZDtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiVlByZWNlaXZlclwiLCBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudElkKTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiVlByZWNlaXZlcjFcIiwgSGxzLmlzU3VwcG9ydGVkKCkpO1xyXG4gICAgdGhpcy52aWRlb09iamVjdC5maWxlID0gbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRJZDtcclxuICAgIHRoaXMudmlkZW9PYmplY3QuZHVyYXRpb24gPSBsb2FkUmVxdWVzdERhdGEubWVkaWEubWV0YWRhdGEuZHVyYXRpb247XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gbG9hZFJlcXVlc3REYXRhLmN1cnJlbnRUaW1lO1xyXG4gICAgdGhpcy5wbGF5YmFja1JhdGUgPSBsb2FkUmVxdWVzdERhdGEucGxheWJhY2tSYXRlO1xyXG4gICAgdGhpcy5hdXRvcGxheSA9IGxvYWRSZXF1ZXN0RGF0YS5hdXRvcGxheTtcclxuICAgIGlmIChsb2FkUmVxdWVzdERhdGEudmFzdFVybCB8fCBsb2FkUmVxdWVzdERhdGEudmFzdFhtbCkge1xyXG4gICAgICB0aGlzLnZhc3RTZXJ2aWNlLmxvYWRBZHMoXHJcbiAgICAgICAgbG9hZFJlcXVlc3REYXRhLnZhc3RVcmwsXHJcbiAgICAgICAgbG9hZFJlcXVlc3REYXRhLnZhc3RYbWxcclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB0aGlzLmF0dGFjaE1lZGlhKCk7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vIElmIHRoZXJlIGlzIG5vIHNvdXJjZSBvciBhIG1hbGZvcm1lZCBJRCB0aGVuIHJldHVybiBhbiBlcnJvci5cclxuICAgIGlmICghc291cmNlIHx8IHNvdXJjZSA9PSBcIlwiIHx8ICFzb3VyY2UubWF0Y2goSURfUkVHRVgpKSB7XHJcbiAgICAgIGxldCBlcnJvciA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvckRhdGEoXHJcbiAgICAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JUeXBlLkxPQURfRkFJTEVEXHJcbiAgICAgICk7XHJcbiAgICAgIGVycm9yLnJlYXNvbiA9IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yUmVhc29uLklOVkFMSURfUkVRVUVTVDtcclxuICAgICAgcmV0dXJuIGVycm9yO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBzb3VyY2VJZCA9IHNvdXJjZS5tYXRjaChJRF9SRUdFWClbMV07XHJcblxyXG4gICAgLy8gQWRkIGJyZWFrcyB0byB0aGUgbWVkaWEgaW5mb3JtYXRpb24gYW5kIHNldCB0aGUgY29udGVudFVybFxyXG4gICAgcmV0dXJuIGFkZEJyZWFrcyhsb2FkUmVxdWVzdERhdGEubWVkaWEpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAvLyBJZiB0aGUgc291cmNlIGlzIGEgdXJsIHRoYXQgcG9pbnRzIHRvIGFuIGFzc2V0IGRvbid0IGZldGNoIGZyb20gYmFja2VuZFxyXG4gICAgICAgIGlmIChzb3VyY2VJZC5pbmNsdWRlcyhcIi5cIikpIHtcclxuICAgICAgICAgIGNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcclxuICAgICAgICAgICAgTE9HX1JFQ0VJVkVSX1RBRyxcclxuICAgICAgICAgICAgXCJJbnRlcmNlcHRvciByZWNlaXZlZCBmdWxsIFVSTFwiXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRVcmwgPSBzb3VyY2U7XHJcbiAgICAgICAgICByZXR1cm4gbG9hZFJlcXVlc3REYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRmV0Y2ggdGhlIGNvbnRlbnRVcmwgaWYgcHJvdmlkZWQgYW4gSUQgb3IgZW50aXR5IFVSTFxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgY2FzdERlYnVnTG9nZ2VyLmRlYnVnKExPR19SRUNFSVZFUl9UQUcsIFwiSW50ZXJjZXB0b3IgcmVjZWl2ZWQgSURcIik7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5mZXRjaE1lZGlhQnlJZChzb3VyY2VJZCkudGhlbigoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbWV0YWRhdGEgPSBuZXcgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuR2VuZXJpY01lZGlhTWV0YWRhdGEoKTtcclxuICAgICAgICAgICAgbWV0YWRhdGEudGl0bGUgPSBpdGVtLnRpdGxlO1xyXG4gICAgICAgICAgICBtZXRhZGF0YS5zdWJ0aXRsZSA9IGl0ZW0uZGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50SWQgPSBpdGVtLnN0cmVhbS5kYXNoO1xyXG4gICAgICAgICAgICBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudFR5cGUgPSBcImFwcGxpY2F0aW9uL2Rhc2greG1sXCI7XHJcbiAgICAgICAgICAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5tZXRhZGF0YSA9IG1ldGFkYXRhO1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZFJlcXVlc3REYXRhO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgICAgIGxldCBlcnJvciA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvckRhdGEoXHJcbiAgICAgICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvclR5cGUuTE9BRF9GQUlMRURcclxuICAgICAgICApO1xyXG4gICAgICAgIGVycm9yLnJlYXNvbiA9IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yUmVhc29uLklOVkFMSURfUkVRVUVTVDtcclxuICAgICAgICBjYXN0RGVidWdMb2dnZXIuZXJyb3IoTE9HX1JFQ0VJVkVSX1RBRywgZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICByZXR1cm4gZXJyb3I7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuICBhZGRCcmVha3MobWVkaWFJbmZvcm1hdGlvbikge1xyXG4gICAgY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICBMT0dfUkVDRUlWRVJfVEFHLFxyXG4gICAgICBcImFkZEJyZWFrczogXCIgKyBKU09OLnN0cmluZ2lmeShtZWRpYUluZm9ybWF0aW9uKVxyXG4gICAgKTtcclxuICAgIHJldHVybiBmZXRjaE1lZGlhQnlJZChcImZiYl9hZFwiKS50aGVuKChjbGlwMSkgPT4ge1xyXG4gICAgICBtZWRpYUluZm9ybWF0aW9uLmJyZWFrQ2xpcHMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6IFwiZmJiX2FkXCIsXHJcbiAgICAgICAgICB0aXRsZTogY2xpcDEudGl0bGUsXHJcbiAgICAgICAgICBjb250ZW50VXJsOiBjbGlwMS5zdHJlYW0uZGFzaCxcclxuICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2Rhc2greG1sXCIsXHJcbiAgICAgICAgICB3aGVuU2tpcHBhYmxlOiA1LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtZWRpYUluZm9ybWF0aW9uLmJyZWFrcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogXCJwcmUtcm9sbFwiLFxyXG4gICAgICAgICAgYnJlYWtDbGlwSWRzOiBbXCJmYmJfYWRcIl0sXHJcbiAgICAgICAgICBwb3NpdGlvbjogMCxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGZldGNoTWVkaWFCeUlkKGlkKSB7XHJcbiAgICBjYXN0RGVidWdMb2dnZXIuZGVidWcoTE9HX1JFQ0VJVkVSX1RBRywgXCJmZXRjaGluZyBpZDogXCIgKyBpZCk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChhY2NlcHQsIHJlamVjdCkgPT4ge1xyXG4gICAgICBmZXRjaChDT05URU5UX1VSTClcclxuICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAudGhlbigob2JqKSA9PiB7XHJcbiAgICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmpbaWRdKSB7XHJcbiAgICAgICAgICAgICAgYWNjZXB0KG9ialtpZF0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJlamVjdChgJHtpZH0gbm90IGZvdW5kIGluIHJlcG9zaXRvcnlgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVqZWN0KFwiQ29udGVudCByZXBvc2l0b3J5IG5vdCBmb3VuZC5cIik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlY2VpdmVyO1xyXG4iLCJpbXBvcnQgU2Vla0JhciBmcm9tIFwiLi9zZWVrYmFyXCI7XHJcbmltcG9ydCBUaW1lciBmcm9tIFwiLi90aW1lclwiO1xyXG5jbGFzcyBSZWNlaXZlckNvbnRyb2xzIHtcclxuICBjb25zdHJ1Y3RvcihpZCkge1xyXG4gICAgdGhpcy5zZWVrYmFyID0gbmV3IFNlZWtCYXIoXCIuc2Vla2Jhci1wcm9ncmVzc1wiKTtcclxuICAgIHRoaXMudGltZXIgPSBuZXcgVGltZXIoXCIudGltZXJcIik7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z2dlciA9IG51bGw7XHJcbiAgICB0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTtcclxuICAgIHRoaXMuc2hvdyA9IHRydWU7XHJcbiAgICB0aGlzLmxvYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubG9hZGVyXCIpO1xyXG4gICAgdGhpcy5wbGF5SWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudnAtaWNvbi1wbGF5XCIpO1xyXG4gICAgdGhpcy5wYXVzZUljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnZwLWljb24tcGF1c2VcIik7XHJcbiAgfVxyXG4gIHNldENhc3REZWJ1Z2dlcihjYXN0RGVidWdnZXIpIHtcclxuICAgIHRoaXMuY2FzdERlYnVnZ2VyID0gY2FzdERlYnVnZ2VyO1xyXG4gICAgdGhpcy5zZWVrYmFyLnNldENhc3REZWJ1Z2dlcih0aGlzLmNhc3REZWJ1Z2dlcik7XHJcbiAgfVxyXG4gIHBhdXNlKCkge1xyXG4gICAgdGhpcy5wYXVzZUljb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgdGhpcy5wbGF5SWNvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMucGxheUljb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgfSwgMjAwMCk7XHJcbiAgfVxyXG4gIHBsYXkoKSB7XHJcbiAgICB0aGlzLnBsYXlJY29uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIHRoaXMucGF1c2VJY29uLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5wYXVzZUljb24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgfSwgMjAwMCk7XHJcbiAgfVxyXG4gIHVwZGF0ZShzdGF0ZSkge1xyXG4gICAgdGhpcy5zZWVrYmFyLnNldFByb2dyZXNzKHN0YXRlLmN1cnJlbnRUaW1lLCBzdGF0ZS5kdXJhdGlvbik7XHJcbiAgICB0aGlzLnRpbWVyLnVwZGF0ZShzdGF0ZS5jdXJyZW50VGltZSwgc3RhdGUuZHVyYXRpb24pO1xyXG4gIH1cclxuICBoaWRlQ29udHJvbHModGltZSkge1xyXG4gICAgdGhpcy5zaG93ID0gZmFsc2U7XHJcbiAgICB0aGlzLnNob3dIaWRlKHRpbWUgfHwgNTAwMCk7XHJcbiAgfVxyXG4gIHNob3dDb250cm9scygpIHtcclxuICAgIHRoaXMuc2hvdyA9IHRydWU7XHJcbiAgICB0aGlzLnNob3dIaWRlKDEwKTtcclxuICB9XHJcbiAgc2hvd0hpZGUodGltaW5nKSB7XHJcbiAgICAvLyB0aGlzLmNhc3RkZWJ1Z2dlci5kZWJ1ZyhcInNob3dIaWRlXCIsIGAke3RpbWluZ30gJHt0aGlzLnNob3d9YCk7XHJcbiAgICBpZiAodGhpcy5zaG93KSB7XHJcbiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICB9LCB0aW1pbmcpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUmVjZWl2ZXJDb250cm9scztcclxuIiwiaW1wb3J0IFV0aWxzIGZyb20gXCIuLi9oZWxwZXJzL1V0aWxzXCI7XHJcblxyXG5jbGFzcyBUaW1lciB7XHJcbiAgY29uc3RydWN0b3IoaWQpIHtcclxuICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5lbGVtZW50LnRleHRDb250ZW50ID0gXCIwMDowMCAvIDAwOjAwXCI7XHJcbiAgfVxyXG4gIHVwZGF0ZShjdXJyZW50VGltZSwgZHVyYXRpb24pIHtcclxuICAgIHRoaXMuZWxlbWVudC50ZXh0Q29udGVudCA9IGAke1V0aWxzLmZvcm1hdFRpbWUoXHJcbiAgICAgIGN1cnJlbnRUaW1lXHJcbiAgICApfSAvJHtVdGlscy5mb3JtYXRUaW1lKGR1cmF0aW9uKX1gO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVGltZXI7XHJcbiIsImNsYXNzIFZhc3RTZXJ2aWNlIHtcclxuICBjb25zdHJ1Y3RvcihyZWNlaXZlcikge1xyXG4gICAgdGhpcy5yZWNlaXZlciA9IHJlY2VpdmVyO1xyXG4gICAgdGhpcy5hZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYWRDb250YWluZXJcIik7XHJcbiAgICB0aGlzLmFkc0Rpc3BsYXlDb250YWluZXIgPSBudWxsO1xyXG4gICAgdGhpcy5hZHNMb2FkZXIgPSBudWxsO1xyXG4gICAgdGhpcy5hZHNEaXNwbGF5SW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuY3VycmVudEFkcyA9IG51bGw7XHJcbiAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICB0aGlzLmF1dG9wbGF5QWxsb3dlZCA9IGZhbHNlO1xyXG4gICAgdGhpcy5hdXRvcGxheVJlcXVpcmVzTXV0ZWQgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGluaXQoKSB7XHJcbiAgICBpZiAoIXdpbmRvdy5nb29nbGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICBnb29nbGUuaW1hLnNldHRpbmdzLnNldFZwYWlkTW9kZShcclxuICAgICAgZ29vZ2xlLmltYS5JbWFTZGtTZXR0aW5ncy5WcGFpZE1vZGUuRU5BQkxFRFxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLmFkc0Rpc3BsYXlDb250YWluZXIgPSBuZXcgZ29vZ2xlLmltYS5BZERpc3BsYXlDb250YWluZXIoXHJcbiAgICAgIHRoaXMuYWRDb250YWluZXIsXHJcbiAgICAgIHRoaXMucmVjZWl2ZXIudmlkZW9cclxuICAgICk7XHJcbiAgICB0aGlzLmFkc0xvYWRlciA9IG5ldyBnb29nbGUuaW1hLkFkc0xvYWRlcih0aGlzLmFkc0Rpc3BsYXlDb250YWluZXIpO1xyXG5cclxuICAgIHRoaXMuYWRzTG9hZGVyLmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgIGdvb2dsZS5pbWEuQWRzTWFuYWdlckxvYWRlZEV2ZW50LlR5cGUuQURTX01BTkFHRVJfTE9BREVELFxyXG4gICAgICB0aGlzLm9uQWRzTWFuYWdlckxvYWRlZC5iaW5kKHRoaXMpLFxyXG4gICAgICBmYWxzZVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLmFkc0xvYWRlci5hZGRFdmVudExpc3RlbmVyKFxyXG4gICAgICBnb29nbGUuaW1hLkFkRXJyb3JFdmVudC5UeXBlLkFEX0VSUk9SLFxyXG4gICAgICB0aGlzLm9uQWRFcnJvcixcclxuICAgICAgZmFsc2VcclxuICAgICk7XHJcbiAgfVxyXG4gIGxvYWRBZHModmFzdFVybCwgdmFzdFhtbCkge1xyXG4gICAgdGhpcy5jdXJyZW50QWRzID0ge307XHJcbiAgICBpZiAoIXdpbmRvdy5nb29nbGUpIHJldHVybjtcclxuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xyXG4gICAgICB0aGlzLmluaXQoKTtcclxuICAgIH1cclxuICAgIGlmICh2YXN0VXJsKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudEFkcy5jb250ZW50ID0gdmFzdFVybDtcclxuICAgICAgdGhpcy5jdXJyZW50QWRzLnR5cGUgPSBcInVybFwiO1xyXG4gICAgfSBlbHNlIGlmICh2YXN0WG1sKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudEFkcy5jb250ZW50ID0gdmFzdFhtbDtcclxuICAgICAgdGhpcy5jdXJyZW50QWRzLnR5cGUgPSBcInhtbFwiO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jdXJyZW50QWRzLmN1cnJlbnRBZEluZGV4ID0gMDtcclxuXHJcbiAgICBpZiAodGhpcy5jdXJyZW50QWRzLnR5cGUgPT09IFwidXJsXCIpIHRoaXMubG9hZCh0aGlzLmN1cnJlbnRBZHMuY29udGVudCk7XHJcbiAgICBlbHNlIHRoaXMubG9hZChudWxsLCB0aGlzLmN1cnJlbnRBZHMuY29udGVudCk7XHJcbiAgfVxyXG4gIG9uRG91YmxlQ2xpY2soZXZlbnQpIHt9XHJcbiAgbG9hZCh2YXN0VXJsLCB2YXN0WG1sKSB7XHJcbiAgICBpZiAoIXdpbmRvdy5nb29nbGUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgZGVidWdnZXI7XHJcbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHRoaXMuaW5pdCgpO1xyXG5cclxuICAgIC8vIHRoaXMuc2tpcE9mZnNldCA9IHRoaXMucGxheWVyLnZpZGVvT2JqZWN0LmFkLnNraXBUaW1lO1xyXG4gICAgdGhpcy5hZENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFxyXG4gICAgICBcImRibGNsaWNrXCIsXHJcbiAgICAgIHRoaXMub25Eb3VibGVDbGljay5iaW5kKHRoaXMpXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuYWRzUmVxdWVzdCA9IG5ldyBnb29nbGUuaW1hLkFkc1JlcXVlc3QoKTtcclxuXHJcbiAgICBpZiAodmFzdFVybCkge1xyXG4gICAgICB0aGlzLmFkc1JlcXVlc3QuYWRUYWdVcmwgPSB2YXN0VXJsO1xyXG4gICAgfSBlbHNlIGlmICh2YXN0WG1sKSB7XHJcbiAgICAgIHRoaXMuYWRzUmVxdWVzdC5hZHNSZXNwb25zZSA9IHZhc3RYbWw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hZHNSZXF1ZXN0LmxpbmVhckFkU2xvdFdpZHRoID0gdGhpcy5yZWNlaXZlci52aWRlby5jbGllbnRXaWR0aDtcclxuICAgIHRoaXMuYWRzUmVxdWVzdC5saW5lYXJBZFNsb3RIZWlnaHQgPSB0aGlzLnJlY2VpdmVyLnZpZGVvLmNsaWVudEhlaWdodDtcclxuICAgIHRoaXMuYWRzUmVxdWVzdC5ub25MaW5lYXJBZFNsb3RXaWR0aCA9IHRoaXMucmVjZWl2ZXIudmlkZW8uY2xpZW50V2lkdGg7XHJcbiAgICB0aGlzLmFkc1JlcXVlc3Qubm9uTGluZWFyQWRTbG90SGVpZ2h0ID1cclxuICAgICAgdGhpcy5yZWNlaXZlci52aWRlby5jbGllbnRIZWlnaHQgLyAzO1xyXG5cclxuICAgIHRoaXMuYWRzUmVxdWVzdC5zZXRBZFdpbGxBdXRvUGxheSh0aGlzLmF1dG9wbGF5QWxsb3dlZCk7XHJcbiAgICB0aGlzLmFkc1JlcXVlc3Quc2V0QWRXaWxsUGxheU11dGVkKHRoaXMuYXV0b3BsYXlSZXF1aXJlc011dGVkKTtcclxuXHJcbiAgICB0aGlzLmFkc1JlcXVlc3QudmFzdExvYWRUaW1lb3V0ID0gODAwMDtcclxuXHJcbiAgICB0aGlzLmFkc0xvYWRlci5yZXF1ZXN0QWRzKHRoaXMuYWRzUmVxdWVzdCk7XHJcbiAgfVxyXG5cclxuICBvbkFkc01hbmFnZXJMb2FkZWQoYWRzTWFuYWdlckxvYWRlZEV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy5hZHNNYW5hZ2VyKSB7XHJcbiAgICAgIHRoaXMuYWRzTWFuYWdlci5kZXN0cm95KCk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBhZHNSZW5kZXJpbmdTZXR0aW5ncyA9IG5ldyBnb29nbGUuaW1hLkFkc1JlbmRlcmluZ1NldHRpbmdzKCk7XHJcbiAgICB0aGlzLmFkc01hbmFnZXIgPSBhZHNNYW5hZ2VyTG9hZGVkRXZlbnQuZ2V0QWRzTWFuYWdlcihcclxuICAgICAgdGhpcy5yZWNlaXZlci52aWRlbyxcclxuICAgICAgYWRzUmVuZGVyaW5nU2V0dGluZ3NcclxuICAgICk7XHJcbiAgICB0aGlzLnBsYXlBZHMoKTtcclxuICB9XHJcbiAgcGxheUFkcygpIHtcclxuICAgIGlmICghdGhpcy5hZHNEaXNwbGF5SW5pdGlhbGl6ZWQpIHtcclxuICAgICAgdGhpcy5hZHNEaXNwbGF5Q29udGFpbmVyLmluaXRpYWxpemUoKTtcclxuICAgICAgdGhpcy5hZHNEaXNwbGF5SW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLnJlY2VpdmVyLnZpZGVvLmNsaWVudFdpZHRoO1xyXG4gICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5yZWNlaXZlci52aWRlby5jbGllbnRIZWlnaHQ7XHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLmFkc01hbmFnZXIuaW5pdCh3aWR0aCwgaGVpZ2h0LCBnb29nbGUuaW1hLlZpZXdNb2RlLkZVTExTQ1JFRU4pO1xyXG4gICAgICB0aGlzLmFkc01hbmFnZXIuc3RhcnQoKTtcclxuICAgICAgdGhpcy5yZWNlaXZlci5yZWNlaXZlckNvbnRyb2xzLmxvYWRlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICB9IGNhdGNoIChhZEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiQWRzTWFuYWdlciBjb3VsZCBub3QgYmUgc3RhcnRlZFwiLCBhZEVycm9yKTtcclxuICAgIH1cclxuICB9XHJcbiAgb25BZEVycm9yKCkge31cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVmFzdFNlcnZpY2U7XHJcbiJdLCJuYW1lcyI6WyJ0aW1lIiwiaG91cnMiLCJNYXRoIiwiZmxvb3IiLCJtaW51dGVzIiwic2Vjb25kcyIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJ2cFJlY2VpdmVyIiwiaWQiLCJjb25maWciLCJyZWNlaXZlciIsImNvbnN0cnVjdG9yIiwidGhpcyIsImNvbnRleHQiLCJwbGF5ZXJNYW5hZ2VyIiwiY2FzdERlYnVnTG9nZ2VyIiwiYXBwSWQiLCJ2aWRlbyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInBsYXliYWNrQ29uZmlnIiwiY29udHJvbHMiLCJobHMiLCJ2aWRlb09iamVjdCIsInZpZGVvQ29udGFpbmVyIiwicGFyZW50RWxlbWVudCIsInBsYXliYWNrUmF0ZSIsImF1dG9wbGF5IiwicmVjZWl2ZXJDb250cm9scyIsInNlZWtiYXIiLCJlbGVtZW50IiwiY2FzdGRlYnVnZ2VyIiwic2hvdyIsInNldENhc3REZWJ1Z2dlciIsInNldFByb2dyZXNzIiwiZHVyYXRpb24iLCJzdHlsZSIsIndpZHRoIiwic2hvd0hpZGUiLCJ0aW1pbmciLCJkZWJ1ZyIsImRpc3BsYXkiLCJzZXRUaW1lb3V0IiwidGltZXIiLCJ0ZXh0Q29udGVudCIsInVwZGF0ZSIsImN1cnJlbnRUaW1lIiwiVXRpbHMiLCJjYXN0RGVidWdnZXIiLCJsb2FkZXIiLCJwbGF5SWNvbiIsInBhdXNlSWNvbiIsInBhdXNlIiwicGxheSIsInN0YXRlIiwiaGlkZUNvbnRyb2xzIiwic2hvd0NvbnRyb2xzIiwibWVkaWFNYW5hZ2VyIiwiY2FzdFJlY2VpdmVyTWFuYWdlciIsInZpZGVvU3RhcnRlZCIsInZhc3RTZXJ2aWNlIiwiYWRDb250YWluZXIiLCJhZHNEaXNwbGF5Q29udGFpbmVyIiwiYWRzTG9hZGVyIiwiYWRzRGlzcGxheUluaXRpYWxpemVkIiwiY3VycmVudEFkcyIsImluaXRpYWxpemVkIiwiYXV0b3BsYXlBbGxvd2VkIiwiYXV0b3BsYXlSZXF1aXJlc011dGVkIiwiaW5pdCIsIndpbmRvdyIsImdvb2dsZSIsImltYSIsInNldHRpbmdzIiwic2V0VnBhaWRNb2RlIiwiSW1hU2RrU2V0dGluZ3MiLCJWcGFpZE1vZGUiLCJFTkFCTEVEIiwiQWREaXNwbGF5Q29udGFpbmVyIiwiQWRzTG9hZGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIkFkc01hbmFnZXJMb2FkZWRFdmVudCIsIlR5cGUiLCJBRFNfTUFOQUdFUl9MT0FERUQiLCJvbkFkc01hbmFnZXJMb2FkZWQiLCJiaW5kIiwiQWRFcnJvckV2ZW50IiwiQURfRVJST1IiLCJvbkFkRXJyb3IiLCJsb2FkQWRzIiwidmFzdFVybCIsInZhc3RYbWwiLCJjb250ZW50IiwidHlwZSIsImN1cnJlbnRBZEluZGV4IiwibG9hZCIsIm9uRG91YmxlQ2xpY2siLCJldmVudCIsImFkc1JlcXVlc3QiLCJBZHNSZXF1ZXN0IiwiYWRUYWdVcmwiLCJhZHNSZXNwb25zZSIsImxpbmVhckFkU2xvdFdpZHRoIiwiY2xpZW50V2lkdGgiLCJsaW5lYXJBZFNsb3RIZWlnaHQiLCJjbGllbnRIZWlnaHQiLCJub25MaW5lYXJBZFNsb3RXaWR0aCIsIm5vbkxpbmVhckFkU2xvdEhlaWdodCIsInNldEFkV2lsbEF1dG9QbGF5Iiwic2V0QWRXaWxsUGxheU11dGVkIiwidmFzdExvYWRUaW1lb3V0IiwicmVxdWVzdEFkcyIsImFkc01hbmFnZXJMb2FkZWRFdmVudCIsImFkc01hbmFnZXIiLCJkZXN0cm95IiwiYWRzUmVuZGVyaW5nU2V0dGluZ3MiLCJBZHNSZW5kZXJpbmdTZXR0aW5ncyIsImdldEFkc01hbmFnZXIiLCJwbGF5QWRzIiwiaW5pdGlhbGl6ZSIsImhlaWdodCIsIlZpZXdNb2RlIiwiRlVMTFNDUkVFTiIsInN0YXJ0IiwiYWRFcnJvciIsImNvbnNvbGUiLCJsb2ciLCJvblBsYXkiLCJ0aGVuIiwiY2F0Y2giLCJvblBhdXNlIiwiYWRkUGxheWVyRXZlbnRzIiwib25UaW1lVXBkYXRlIiwidXBkYXRlUGxheWVyU3RhdGUiLCJhdHRhY2hNZWRpYSIsIkhMU3N1cHBvcnRlZCIsIkhscyIsImlzU3VwcG9ydGVkIiwiSlNPTiIsInN0cmluZ2lmeSIsImZpbGUiLCJlbmRzV2l0aCIsInNyYyIsIm9uIiwiRXZlbnRzIiwiTUVESUFfQVRUQUNIRUQiLCJzdGFydExldmVsIiwibG9hZFNvdXJjZSIsIk1BTklGRVNUX1BBUlNFRCIsImRhdGEiLCJjdXJyZW50TGV2ZWwiLCJFUlJPUiIsImRldGFpbHMiLCJlcnJvciIsImZha2Vpbml0IiwibWVzc2FnZSIsImJpbmRNZXRob2RzIiwiY2FzdCIsImZyYW1ld29yayIsIkNhc3RSZWNlaXZlckNvbnRleHQiLCJnZXRJbnN0YW5jZSIsInNldExvZ2dlckxldmVsIiwiTG9nZ2VyTGV2ZWwiLCJERUJVRyIsImdldFBsYXllck1hbmFnZXIiLCJzZXRNZWRpYUVsZW1lbnQiLCJDYXN0RGVidWdMb2dnZXIiLCJzZXRFbmFibGVkIiwiYmluZEludGVyY2VwdG9ycyIsIm9uU2VlayIsInJlcXVlc3REYXRhIiwiZHJhd0J1dHRvbnMiLCJhc3NpZ25CdXR0b24iLCJ1aSIsIkNvbnRyb2xzU2xvdCIsIlNMT1RfU0VDT05EQVJZXzEiLCJDb250cm9sc0J1dHRvbiIsIlFVRVVFX1BSRVYiLCJTTE9UX1BSSU1BUllfMSIsIkNBUFRJT05TIiwiU0xPVF9QUklNQVJZXzIiLCJTRUVLX0ZPUldBUkRfMTUiLCJTTE9UX1NFQ09OREFSWV8yIiwiUVVFVUVfTkVYVCIsInNldE1lc3NhZ2VJbnRlcmNlcHRvciIsIm1lc3NhZ2VzIiwiTWVzc2FnZVR5cGUiLCJMT0FEIiwib25Mb2FkUmVxdWVzdCIsIlBMQVkiLCJQQVVTRSIsIlNFRUsiLCJsb2FkUmVxdWVzdERhdGEiLCJtZWRpYSIsImNvbnRlbnRJZCIsIm1ldGFkYXRhIiwiYWRkQnJlYWtzIiwibWVkaWFJbmZvcm1hdGlvbiIsIkxPR19SRUNFSVZFUl9UQUciLCJmZXRjaE1lZGlhQnlJZCIsImNsaXAxIiwiYnJlYWtDbGlwcyIsInRpdGxlIiwiY29udGVudFVybCIsInN0cmVhbSIsImRhc2giLCJjb250ZW50VHlwZSIsIndoZW5Ta2lwcGFibGUiLCJicmVha3MiLCJicmVha0NsaXBJZHMiLCJwb3NpdGlvbiIsIlByb21pc2UiLCJhY2NlcHQiLCJyZWplY3QiLCJmZXRjaCIsIkNPTlRFTlRfVVJMIiwicmVzcG9uc2UiLCJqc29uIiwib2JqIl0sInNvdXJjZVJvb3QiOiIifQ==