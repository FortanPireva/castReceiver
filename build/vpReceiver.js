(()=>{"use strict";function e(e,t){let s=new class{constructor(e,t){this.context=null,this.playerManager=null,this.castDebugLogger=null,this.appId=t.appId,this.video=document.querySelector(e),this.playbackConfig=null,this.controls=null,this.hls=null,this.videoObject={},this.videoContainer=this.video.parentElement,this.playbackRate=1,this.autoplay=!1,this.receiverControls=new class{constructor(e){this.seekbar=new class{constructor(e){this.element=document.querySelector(e),this.castdebugger=null,this.show=!1}setCastDebugger(e){this.castdebugger=e}setProgress(e,t){this.element.style.width=e/t*100+"%"}showHide(e){this.castdebugger.debug("showHide",`${e} ${this.show}`),this.show?this.element.parentElement.style.display="block":setTimeout((()=>{this.element.parentElement.style.display="none"}),e)}}(".seekbar-progress"),this.timer=new class{constructor(e){this.element=document.querySelector(e)}update(e,t){let s=Math.floor(e/60);1==s.length&&(s="0"+s),e%=60;let i=Math.floor(t/60);1==i.length&&(i="0"+i),this.element.innerHtml=`${s}:${e} / ${i}:${t}`}}(".timer"),this.castDebugger=null,this.element=document.querySelector(e),this.show=!0}setCastDebugger(e){this.castDebugger=e,this.seekbar.setCastDebugger(this.castDebugger)}update(e){this.seekbar.setProgress(e.currenTtime,e.duration),this.timer.update(e.currenTtime,e.duration)}hideControls(e){this.show=!1,this.showHide(e||5e3)}showControls(){this.show=!0,this.showHide(10)}showHide(e){this.show?this.element.style.display="block":setTimeout((()=>{this.element.style.display="none"}),e)}}(".controls"),this.mediaManager=null,this.castReceiverManager=null}start(){this.onPlay()}onPlay(){this.video.play().then((()=>{})).catch((()=>{})),this.receiverControls.hideControls(6e3)}onPause(){this.video.pause(),this.receiverControls.showControls()}addPlayerEvents(){this.video.addEventListener("timeupdate",this.onTimeUpdate)}onTimeUpdate(){this.receiverControls.update(this.updatePlayerState())}updatePlayerState(){return{currentTime:this.video.currentTime,duration:this.videoObject.duration}}attachMedia(){if(vpReceiver.HLSsupported=Hls.isSupported(),this.castDebugLogger.debug("inside attach media",vpReceiver.HLSsupported),this.video.playbackRate=1,this.castDebugLogger.debug("video file",JSON.stringify(this.video,["id","className","tagName"])),this.videoObject.file.endsWith("mp4"))this.castDebugLogger.debug("inside mp4",this.videoObject.file),this.video.src=this.videoObject.file,this.start();else if(vpReceiver.HLSsupported){this.castDebugLogger.debug("inside hlssupported",this.videoObject.file);try{this.hls=new Hls,this.castDebugLogger.debug("hls initialized",this.videoObject.file),this.hls.attachMedia(this.video),this.castDebugLogger.debug("attached media",this.videoObject.file),this.hls.on(Hls.Events.MEDIA_ATTACHED,(()=>{this.castDebugLogger.debug("amedia attached",this.videoObject.file),this.hls.startLevel=0,this.castDebugLogger.debug("loading source hlssupported",this.videoObject.file),this.hls.loadSource(this.videoObject.file)})),this.hls.on(Hls.Events.MANIFEST_PARSED,((e,t)=>{this.castDebugLogger.debug("manifest parsed",this.videoObject.file),this.start()})),this.hls.on(Hls.Events.ERROR,((e,t)=>{this.castDebugLogger.debug("HLS  ERROR",t.details)}))}catch(e){this.castDebugLogger.debug("hls error",e)}}this.castDebugLogger.debug("finished attach media")}fakeinit(){const e=cast.framework.CastReceiverContext.getInstance();e.getPlayerManager(),this.castDebugLogger={debug:function(e,t){console.debug(e,t)}},this.receiverControls.setCastDebugger(this.castDebugLogger),this.videoObject.file="https://vp.gjirafa.net/vps/prod/odgehtyo/encode/vjsmylds/mp4/360p.mp4",this.attachMedia(),this.bindMethods(),this.addPlayerEvents(),e.start()}init(){this.context=cast.framework.CastReceiverContext.getInstance(),this.context.setLoggerLevel(cast.framework.LoggerLevel.DEBUG),this.playerManager=this.context.getPlayerManager(),this.playerManager.setMediaElement(this.video),this.castDebugLogger=cast.debug.CastDebugLogger.getInstance(),this.castDebugLogger.setEnabled(!0),this.castDebugLogger.debug("hello","okej"),this.receiverControls.setCastDebugger(this.castDebugLogger),this.context.start(),this.bindMethods(),this.bindInterceptors(),this.addPlayerEvents()}onSeek(e){var t=e.data.currentTime;this.video.currentTime=t,this.receiverControls.update(this.updatePlayerState())}drawButtons(){this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_1,cast.framework.ui.ControlsButton.QUEUE_PREV),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_1,cast.framework.ui.ControlsButton.CAPTIONS),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_2,cast.framework.ui.ControlsButton.SEEK_FORWARD_15),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_2,cast.framework.ui.ControlsButton.QUEUE_NEXT)}bindInterceptors(){this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD,this.onLoadRequest.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PLAY,this.onPlay.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PAUSE,this.onPause.bind(this))}bindMethods(){this.bindInterceptors=this.bindInterceptors.bind(this),this.onLoadRequest=this.onLoadRequest.bind(this),this.attachMedia=this.attachMedia.bind(this),this.start=this.start.bind(this),this.addPlayerEvents=this.addPlayerEvents.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onPlay=this.onPlay.bind(this),this.onPause=this.onPause.bind(this),this.updatePlayerState=this.updatePlayerState.bind(this)}onLoadRequest(e){return this.castDebugLogger.debug("VPreceiver",e.media.contentId),this.castDebugLogger.debug("VPreceiver1",Hls.isSupported()),this.videoObject.file=e.media.contentId,this.videoObject.duration=e.media.metadata.duration,this.currentTime=e.currentTime,this.playbackRate=e.playbackRate,this.autoplay=e.autoplay,this.attachMedia(),null}addBreaks(e){return castDebugLogger.debug(LOG_RECEIVER_TAG,"addBreaks: "+JSON.stringify(e)),fetchMediaById("fbb_ad").then((t=>{e.breakClips=[{id:"fbb_ad",title:t.title,contentUrl:t.stream.dash,contentType:"application/dash+xml",whenSkippable:5}],e.breaks=[{id:"pre-roll",breakClipIds:["fbb_ad"],position:0}]}))}fetchMediaById(e){return castDebugLogger.debug(LOG_RECEIVER_TAG,"fetching id: "+e),new Promise(((t,s)=>{fetch(CONTENT_URL).then((e=>e.json())).then((i=>{i?i[e]?t(i[e]):s(`${e} not found in repository`):s("Content repository not found.")}))}))}}(e,t);return s.init(),s}e.HLSsupported=!1,window.vpReceiver=e})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNQyxhQUNIM0YsTUFBTTRGLEdBQWFBLEVBQVNDLFNBQzVCN0YsTUFBTThGLElBQ0RBLEVBQ0VBLEVBQUlySixHQUNOK0ksRUFBT00sRUFBSXJKLElBRVhnSixFQUFRLEdBQUVoSiw2QkFHWmdKLEVBQU8seUNEblhXaEosRUFBSUMsR0FFaEMsT0FEQUMsRUFBUzJGLE9BQ0YzRixFQUxUSCxFQUFXaUUsY0FBZSxFQVExQnNGLE9BQU92SixXQUFhQSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdnAtcmVjZWl2ZXIvLi9zcmMvanMvdnBSZWNlaXZlci5qcyIsIndlYnBhY2s6Ly92cC1yZWNlaXZlci8uL3NyYy9qcy9tb2RlbHMvcmVjZWl2ZXIuanMiLCJ3ZWJwYWNrOi8vdnAtcmVjZWl2ZXIvLi9zcmMvanMvbW9kZWxzL3JlY2VpdmVyLWNvbnRyb2xzLmpzIiwid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL21vZGVscy9zZWVrYmFyLmpzIiwid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL21vZGVscy90aW1lci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVjZWl2ZXIgZnJvbSBcIi4vbW9kZWxzL3JlY2VpdmVyXCI7XHJcblxyXG4vL2EgYm9vbGVhbiB0ZWxsaW5nIHdoZXRoZXIgSExTIGlzIHN1cHBvcnRlZCBpbiB0aGUgYnJvd3NlclxyXG52cFJlY2VpdmVyLkhMU3N1cHBvcnRlZCA9IGZhbHNlO1xyXG5cclxuZnVuY3Rpb24gdnBSZWNlaXZlcihpZCwgY29uZmlnKSB7XHJcbiAgbGV0IHJlY2VpdmVyID0gbmV3IFJlY2VpdmVyKGlkLCBjb25maWcpO1xyXG4gIHJlY2VpdmVyLmluaXQoKTtcclxuICByZXR1cm4gcmVjZWl2ZXI7XHJcbn1cclxuXHJcbndpbmRvdy52cFJlY2VpdmVyID0gdnBSZWNlaXZlcjtcclxuIiwiaW1wb3J0IGhsc2NvbmZpZyBmcm9tIFwiLi4vY29uZmlnL2hsc0NvbmZpZ1wiO1xyXG5pbXBvcnQgUmVjZWl2ZXJDb250cm9scyBmcm9tIFwiLi9yZWNlaXZlci1jb250cm9sc1wiO1xyXG5jbGFzcyBSZWNlaXZlciB7XHJcbiAgY29uc3RydWN0b3IoaWQsIGNvbmZpZykge1xyXG4gICAgdGhpcy5jb250ZXh0ID0gbnVsbDtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlciA9IG51bGw7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlciA9IG51bGw7XHJcbiAgICB0aGlzLmFwcElkID0gY29uZmlnLmFwcElkO1xyXG4gICAgdGhpcy52aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5wbGF5YmFja0NvbmZpZyA9IG51bGw7XHJcbiAgICB0aGlzLmNvbnRyb2xzID0gbnVsbDtcclxuICAgIHRoaXMuaGxzID0gbnVsbDtcclxuICAgIHRoaXMudmlkZW9PYmplY3QgPSB7fTtcclxuICAgIHRoaXMudmlkZW9Db250YWluZXIgPSB0aGlzLnZpZGVvLnBhcmVudEVsZW1lbnQ7XHJcbiAgICB0aGlzLnBsYXliYWNrUmF0ZSA9IDE7XHJcbiAgICB0aGlzLmF1dG9wbGF5ID0gZmFsc2U7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMgPSBuZXcgUmVjZWl2ZXJDb250cm9scyhcIi5jb250cm9sc1wiKTtcclxuICAgIHRoaXMubWVkaWFNYW5hZ2VyID0gbnVsbDtcclxuICAgIHRoaXMuY2FzdFJlY2VpdmVyTWFuYWdlciA9IG51bGw7XHJcbiAgfVxyXG4gIHN0YXJ0KCkge1xyXG4gICAgdGhpcy5vblBsYXkoKTtcclxuICB9XHJcblxyXG4gIG9uUGxheSgpIHtcclxuICAgIC8vIHJldHVybiB0aGlzLnBsYXllck1hbmFnZXIucGxheSgpO1xyXG4gICAgdGhpcy52aWRlb1xyXG4gICAgICAucGxheSgpXHJcbiAgICAgIC50aGVuKCgpID0+IHt9KVxyXG4gICAgICAuY2F0Y2goKCkgPT4ge30pO1xyXG4gICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzLmhpZGVDb250cm9scyg2MDAwKTtcclxuICB9XHJcbiAgb25QYXVzZSgpIHtcclxuICAgIHRoaXMudmlkZW8ucGF1c2UoKTtcclxuICAgIHRoaXMucmVjZWl2ZXJDb250cm9scy5zaG93Q29udHJvbHMoKTtcclxuICB9XHJcbiAgYWRkUGxheWVyRXZlbnRzKCkge1xyXG4gICAgdGhpcy52aWRlby5hZGRFdmVudExpc3RlbmVyKFwidGltZXVwZGF0ZVwiLCB0aGlzLm9uVGltZVVwZGF0ZSk7XHJcbiAgfVxyXG4gIG9uVGltZVVwZGF0ZSgpIHtcclxuICAgIHRoaXMucmVjZWl2ZXJDb250cm9scy51cGRhdGUodGhpcy51cGRhdGVQbGF5ZXJTdGF0ZSgpKTtcclxuICB9XHJcbiAgdXBkYXRlUGxheWVyU3RhdGUoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBjdXJyZW50VGltZTogdGhpcy52aWRlby5jdXJyZW50VGltZSxcclxuICAgICAgZHVyYXRpb246IHRoaXMudmlkZW9PYmplY3QuZHVyYXRpb24sXHJcbiAgICB9O1xyXG4gIH1cclxuICBhdHRhY2hNZWRpYSgpIHtcclxuICAgIHZwUmVjZWl2ZXIuSExTc3VwcG9ydGVkID0gSGxzLmlzU3VwcG9ydGVkKCk7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcImluc2lkZSBhdHRhY2ggbWVkaWFcIiwgdnBSZWNlaXZlci5ITFNzdXBwb3J0ZWQpO1xyXG4gICAgdGhpcy52aWRlby5wbGF5YmFja1JhdGUgPSAxO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXHJcbiAgICAgIFwidmlkZW8gZmlsZVwiLFxyXG4gICAgICBKU09OLnN0cmluZ2lmeSh0aGlzLnZpZGVvLCBbXCJpZFwiLCBcImNsYXNzTmFtZVwiLCBcInRhZ05hbWVcIl0pXHJcbiAgICApO1xyXG4gICAgaWYgKHRoaXMudmlkZW9PYmplY3QuZmlsZS5lbmRzV2l0aChcIm1wNFwiKSkge1xyXG4gICAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcImluc2lkZSBtcDRcIiwgdGhpcy52aWRlb09iamVjdC5maWxlKTtcclxuICAgICAgdGhpcy52aWRlby5zcmMgPSB0aGlzLnZpZGVvT2JqZWN0LmZpbGU7XHJcbiAgICAgIHRoaXMuc3RhcnQoKTtcclxuICAgIH0gZWxzZSBpZiAodnBSZWNlaXZlci5ITFNzdXBwb3J0ZWQpIHtcclxuICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJpbnNpZGUgaGxzc3VwcG9ydGVkXCIsIHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdGhpcy5obHMgPSBuZXcgSGxzKCk7XHJcbiAgICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJobHMgaW5pdGlhbGl6ZWRcIiwgdGhpcy52aWRlb09iamVjdC5maWxlKTtcclxuICAgICAgICB0aGlzLmhscy5hdHRhY2hNZWRpYSh0aGlzLnZpZGVvKTtcclxuICAgICAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcImF0dGFjaGVkIG1lZGlhXCIsIHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcblxyXG4gICAgICAgIHRoaXMuaGxzLm9uKEhscy5FdmVudHMuTUVESUFfQVRUQUNIRUQsICgpID0+IHtcclxuICAgICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiYW1lZGlhIGF0dGFjaGVkXCIsIHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgICB0aGlzLmhscy5zdGFydExldmVsID0gMDtcclxuICAgICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICAgICAgICBcImxvYWRpbmcgc291cmNlIGhsc3N1cHBvcnRlZFwiLFxyXG4gICAgICAgICAgICB0aGlzLnZpZGVvT2JqZWN0LmZpbGVcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICB0aGlzLmhscy5sb2FkU291cmNlKHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5obHMub24oSGxzLkV2ZW50cy5NQU5JRkVTVF9QQVJTRUQsIChldmVudCwgZGF0YSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJtYW5pZmVzdCBwYXJzZWRcIiwgdGhpcy52aWRlb09iamVjdC5maWxlKTtcclxuICAgICAgICAgIHRoaXMuc3RhcnQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmhscy5vbihIbHMuRXZlbnRzLkVSUk9SLCAoZXZlbnQsIGRhdGEpID0+IHtcclxuICAgICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiSExTICBFUlJPUlwiLCBkYXRhLmRldGFpbHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaGxzIGVycm9yXCIsIGVycm9yKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdGhpcy5obHMub24oSGxzLkV2ZW50cy5FUlJPUiwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgIC8vICAgaWYgKGRhdGEuZGV0YWlscyA9PT0gXCJtYW5pZmVzdExvYWRFcnJvclwiKSB7XHJcbiAgICAgIC8vICAgICB0aGlzLnZpZGVvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLmhpZGVDb250ZW50KTtcclxuICAgICAgLy8gICAgIHRoaXMudmlkZW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuc2hvd0Vycm9yKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwibWFuaWZlc3RMb2FkVGltZU91dFwiKSB7XHJcbiAgICAgIC8vICAgICB0aGlzLnZpZGVvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLmhpZGVDb250ZW50KTtcclxuICAgICAgLy8gICAgIHRoaXMudmlkZW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuc2hvd0Vycm9yKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwibWFuaWZlc3RQYXJzaW5nRXJyb3JcIikge1xyXG4gICAgICAvLyAgICAgdGhpcy52aWRlb0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNzc0NsYXNzZXMuZWZmZWN0cy5oaWRlQ29udGVudCk7XHJcbiAgICAgIC8vICAgICB0aGlzLnZpZGVvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLnNob3dFcnJvcik7XHJcbiAgICAgIC8vICAgfVxyXG5cclxuICAgICAgLy8gICBpZiAoZGF0YS5kZXRhaWxzID09PSBcImxldmVsTG9hZEVycm9yXCIpIHtcclxuICAgICAgLy8gICAgIHRoaXMucmVtb3ZlTGV2ZWwoZGF0YS5jb250ZXh0LmxldmVsKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwiZnJhZ0xvYWRFcnJvclwiKSB7XHJcbiAgICAgIC8vICAgICB0aGlzLmZyYWdFcnJvckNvdW50Kys7XHJcbiAgICAgIC8vICAgICAvLyBzbiByZWZlcmVzIHRvIHNlcXVlbmNlIG51bWJlclxyXG4gICAgICAvLyAgICAgaWYgKGRhdGEuZnJhZy5zbiA9PSAwKSB0aGlzLmZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQgPSB0cnVlO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgaWYgKHRoaXMubGV2ZWxIYXNNaXNzaW5nRnJhZ21lbnRzKCkpIHtcclxuICAgICAgLy8gICAgIHRoaXMuZnJhZ0Vycm9yQ291bnQgPSAwO1xyXG4gICAgICAvLyAgICAgdGhpcy5yZW1vdmVMZXZlbChkYXRhLmZyYWcubGV2ZWwpO1xyXG4gICAgICAvLyAgICAgdGhpcy5obHMubG9hZExldmVsID0gLTE7XHJcbiAgICAgIC8vICAgICBjb25zb2xlLmxvZyhcIk5ldHdvcmsgZXJyb3IgZW5jb3VudGVyZWRcIik7XHJcbiAgICAgIC8vICAgfVxyXG5cclxuICAgICAgLy8gICBpZiAodGhpcy5mYWlsZWRUb0xvYWRGaXJzdEZyYWdtZW50KSB7XHJcbiAgICAgIC8vICAgICB0aGlzLmZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQgPSBmYWxzZTtcclxuICAgICAgLy8gICAgIHRoaXMucmVtb3ZlTGV2ZWwoZGF0YS5mcmFnLmxldmVsKTtcclxuICAgICAgLy8gICAgIHRoaXMuaGxzLmxvYWRMZXZlbCA9IC0xO1xyXG4gICAgICAvLyAgICAgdGhpcy5vblBsYXkoKTtcclxuICAgICAgLy8gICAgIGNvbnNvbGUubG9nKFwiTmV0d29yayBlcnJvciBlbmNvdW50ZXJlZFwiKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmICghZGF0YS5mYXRhbCkge1xyXG4gICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcclxuICAgICAgLy8gICAgIGNhc2UgSGxzLkVycm9yVHlwZXMuTkVUV09SS19FUlJPUjpcclxuICAgICAgLy8gICAgICAgY29uc29sZS5sb2coXCJmYXRhbCBuZXR3b3JrIGVycm9yIGVuY291bnRlcmVkXCIpO1xyXG4gICAgICAvLyAgICAgICB0aGlzLmhscy5zdGFydExvYWQoKTtcclxuICAgICAgLy8gICAgICAgYnJlYWs7XHJcbiAgICAgIC8vICAgICBjYXNlIEhscy5FcnJvclR5cGVzLk1FRElBX0VSUk9SOlxyXG4gICAgICAvLyAgICAgICBjb25zb2xlLmxvZyhcImZhdGFsIG1lZGlhIGVycm9yIGVuY291bnRlcmVkXCIpO1xyXG4gICAgICAvLyAgICAgICB0aGlzLmhscy5yZWNvdmVyTWVkaWFFcnJvcigpO1xyXG4gICAgICAvLyAgICAgICBicmVhaztcclxuICAgICAgLy8gICAgIGRlZmF1bHQ6XHJcbiAgICAgIC8vICAgICAgIHRoaXMuaGxzLmRlc3Ryb3koKTtcclxuICAgICAgLy8gICAgICAgYnJlYWs7XHJcbiAgICAgIC8vICAgfVxyXG4gICAgICAvLyB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiZmluaXNoZWQgYXR0YWNoIG1lZGlhXCIpO1xyXG4gICAgLy8gIGVsc2UgaWYgKHRoaXMudmlkZW8uY2FuUGxheVR5cGUoXCJhcHBsaWNhdGlvbi92bmQuYXBwbGUubXBlZ3VybFwiKSkge1xyXG4gICAgLy8gICB0aGlzLnZpZGVvLnNyYyA9IHRoaXMudmlkZW9PYmplY3QuZmlsZTtcclxuICAgIC8vICAgaWYgKFV0aWxzLmlzSU9TKCkpIHtcclxuICAgIC8vICAgICBmcHNfZHJtLmluaXQoXHJcbiAgICAvLyAgICAgICB0aGlzLnZpZGVvLFxyXG4gICAgLy8gICAgICAgY29uZmlnLmZwc0NlcnRpZmljYXRlVXJsLFxyXG4gICAgLy8gICAgICAgdGhpcy52aWRlb09iamVjdC5hc3NldElkXHJcbiAgICAvLyAgICAgKTtcclxuICAgIC8vICAgfVxyXG4gICAgLy8gICB0aGlzLnZpZGVvLnBsYXlzSW5saW5lID0gdHJ1ZTtcclxuICAgIC8vICAgdGhpcy5zdGFydCgpO1xyXG4gICAgLy8gfVxyXG4gIH1cclxuICBmYWtlaW5pdCgpIHtcclxuICAgIGNvbnN0IGNvbnRleHQgPSBjYXN0LmZyYW1ld29yay5DYXN0UmVjZWl2ZXJDb250ZXh0LmdldEluc3RhbmNlKCk7XHJcbiAgICBjb25zdCBwbGF5ZXJNYW5hZ2VyID0gY29udGV4dC5nZXRQbGF5ZXJNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlciA9IHtcclxuICAgICAgZGVidWc6IGZ1bmN0aW9uICh0eXBlLCBtZXNzYWdlKSB7XHJcbiAgICAgICAgY29uc29sZS5kZWJ1Zyh0eXBlLCBtZXNzYWdlKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuc2V0Q2FzdERlYnVnZ2VyKHRoaXMuY2FzdERlYnVnTG9nZ2VyKTtcclxuICAgIHRoaXMudmlkZW9PYmplY3QuZmlsZSA9XHJcbiAgICAgIFwiaHR0cHM6Ly92cC5namlyYWZhLm5ldC92cHMvcHJvZC9vZGdlaHR5by9lbmNvZGUvdmpzbXlsZHMvbXA0LzM2MHAubXA0XCI7XHJcbiAgICB0aGlzLmF0dGFjaE1lZGlhKCk7XHJcbiAgICB0aGlzLmJpbmRNZXRob2RzKCk7XHJcbiAgICAvLyB0aGlzLmJpbmRJbnRlcmNlcHRvcnMoKTtcclxuICAgIHRoaXMuYWRkUGxheWVyRXZlbnRzKCk7XHJcbiAgICBjb250ZXh0LnN0YXJ0KCk7XHJcbiAgfVxyXG4gIGluaXQoKSB7XHJcbiAgICAvLyB0aGlzLmJpbmRNZXRob2RzKCk7XHJcbiAgICB0aGlzLmNvbnRleHQgPSBjYXN0LmZyYW1ld29yay5DYXN0UmVjZWl2ZXJDb250ZXh0LmdldEluc3RhbmNlKCk7XHJcblxyXG4gICAgdGhpcy5jb250ZXh0LnNldExvZ2dlckxldmVsKGNhc3QuZnJhbWV3b3JrLkxvZ2dlckxldmVsLkRFQlVHKTtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlciA9IHRoaXMuY29udGV4dC5nZXRQbGF5ZXJNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIuc2V0TWVkaWFFbGVtZW50KHRoaXMudmlkZW8pO1xyXG4gICAgLy8gdGhpcy5jYXN0UmVjZWl2ZXJNYW5hZ2VyID0gY2FzdC5yZWNlaXZlci5DYXN0UmVjZWl2ZXJNYW5hZ2VyLmdldEluc3RhbmNlKCk7XHJcbiAgICAvLyB0aGlzLm1lZGlhTWFuYWdlciA9IG5ldyBjYXN0LnJlY2VpdmVyLk1lZGlhTWFuYWdlcih0aGlzLnZpZGVvKTtcclxuXHJcbiAgICAvLyB0aGlzLm1lZGlhTWFuYWdlci5vblNlZWsgPSB0aGlzLm9uU2Vlay5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIgPSBjYXN0LmRlYnVnLkNhc3REZWJ1Z0xvZ2dlci5nZXRJbnN0YW5jZSgpO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuc2V0RW5hYmxlZCh0cnVlKTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaGVsbG9cIiwgXCJva2VqXCIpO1xyXG5cclxuICAgIHRoaXMucmVjZWl2ZXJDb250cm9scy5zZXRDYXN0RGVidWdnZXIodGhpcy5jYXN0RGVidWdMb2dnZXIpO1xyXG4gICAgLy8gdGhpcy5wbGF5YmFja0NvbmZpZy5hdXRvUmVzdW1lRHVyYXRpb24gPSA1O1xyXG4gICAgLy8gdGhpcy5jYXN0RGVidWdMb2dnZXIuaW5mbyhMT0dfUkVDRUlWRVJfVEFHLCBgYXV0b2luaXQ6IGApO1xyXG4gICAgLy8gdGhpcy5jb250cm9scy5jbGVhckRlZmF1bHRTbG90QXNzaWdubWVudHMoKTtcclxuICAgIC8vIHRoaXMuZHJhd0J1dHRvbnMoKTtcclxuXHJcbiAgICAvLyBjb250ZXh0LnN0YXJ0KHtcclxuICAgIC8vICAgcXVldWU6IG5ldyBDYXN0UXVldWUoKSxcclxuICAgIC8vICAgcGxheWJhY2tDb25maWc6IHRoaXMucGxheWJhY2tDb25maWcsXHJcbiAgICAvLyAgIHN1cHBvcnRlZENvbW1hbmRzOlxyXG4gICAgLy8gICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkNvbW1hbmQuQUxMX0JBU0lDX01FRElBIHxcclxuICAgIC8vICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5Db21tYW5kLlFVRVVFX1BSRVYgfFxyXG4gICAgLy8gICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkNvbW1hbmQuUVVFVUVfTkVYVCB8XHJcbiAgICAvLyAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuQ29tbWFuZC5TVFJFQU1fVFJBTlNGRVIsXHJcbiAgICAvLyB9KTtcclxuICAgIC8vIHRoaXMuYmluZEludGVyY2VwdG9ycygpO1xyXG4gICAgLy8gdGhpcy52aWRlb09iamVjdC5maWxlID1cclxuICAgIC8vICAgXCJodHRwczovL3ZwLmdqaXJhZmEubmV0L3Zwcy9wcm9kL29kZ2VodHlvL2VuY29kZS92anNteWxkcy9tcDQvMzYwcC5tcDRcIjtcclxuICAgIC8vIHRoaXMuYXR0YWNoTWVkaWEoKTtcclxuICAgIHRoaXMuY29udGV4dC5zdGFydCgpO1xyXG4gICAgdGhpcy5iaW5kTWV0aG9kcygpO1xyXG4gICAgdGhpcy5iaW5kSW50ZXJjZXB0b3JzKCk7XHJcbiAgICB0aGlzLmFkZFBsYXllckV2ZW50cygpO1xyXG4gIH1cclxuICBvblNlZWsoZXZlbnQpIHtcclxuICAgIHZhciBjdXJyZW50VGltZSA9IGV2ZW50LmRhdGEuY3VycmVudFRpbWU7XHJcbiAgICB0aGlzLnZpZGVvLmN1cnJlbnRUaW1lID0gY3VycmVudFRpbWU7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMudXBkYXRlKHRoaXMudXBkYXRlUGxheWVyU3RhdGUoKSk7XHJcbiAgfVxyXG4gIGRyYXdCdXR0b25zKCkge1xyXG4gICAgdGhpcy5jb250cm9scy5hc3NpZ25CdXR0b24oXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzU2xvdC5TTE9UX1NFQ09OREFSWV8xLFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc0J1dHRvbi5RVUVVRV9QUkVWXHJcbiAgICApO1xyXG4gICAgdGhpcy5jb250cm9scy5hc3NpZ25CdXR0b24oXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzU2xvdC5TTE9UX1BSSU1BUllfMSxcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNCdXR0b24uQ0FQVElPTlNcclxuICAgICk7XHJcbiAgICB0aGlzLmNvbnRyb2xzLmFzc2lnbkJ1dHRvbihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNTbG90LlNMT1RfUFJJTUFSWV8yLFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc0J1dHRvbi5TRUVLX0ZPUldBUkRfMTVcclxuICAgICk7XHJcbiAgICB0aGlzLmNvbnRyb2xzLmFzc2lnbkJ1dHRvbihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNTbG90LlNMT1RfU0VDT05EQVJZXzIsXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzQnV0dG9uLlFVRVVFX05FWFRcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBiaW5kSW50ZXJjZXB0b3JzKCkge1xyXG4gICAgdGhpcy5wbGF5ZXJNYW5hZ2VyLnNldE1lc3NhZ2VJbnRlcmNlcHRvcihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuTWVzc2FnZVR5cGUuTE9BRCxcclxuICAgICAgdGhpcy5vbkxvYWRSZXF1ZXN0LmJpbmQodGhpcylcclxuICAgICk7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIuc2V0TWVzc2FnZUludGVyY2VwdG9yKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5NZXNzYWdlVHlwZS5QTEFZLFxyXG4gICAgICB0aGlzLm9uUGxheS5iaW5kKHRoaXMpXHJcbiAgICApO1xyXG4gICAgdGhpcy5wbGF5ZXJNYW5hZ2VyLnNldE1lc3NhZ2VJbnRlcmNlcHRvcihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuTWVzc2FnZVR5cGUuUEFVU0UsXHJcbiAgICAgIHRoaXMub25QYXVzZS5iaW5kKHRoaXMpXHJcbiAgICApO1xyXG4gIH1cclxuICBiaW5kTWV0aG9kcygpIHtcclxuICAgIHRoaXMuYmluZEludGVyY2VwdG9ycyA9IHRoaXMuYmluZEludGVyY2VwdG9ycy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbkxvYWRSZXF1ZXN0ID0gdGhpcy5vbkxvYWRSZXF1ZXN0LmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmF0dGFjaE1lZGlhID0gdGhpcy5hdHRhY2hNZWRpYS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5zdGFydCA9IHRoaXMuc3RhcnQuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuYWRkUGxheWVyRXZlbnRzID0gdGhpcy5hZGRQbGF5ZXJFdmVudHMuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25UaW1lVXBkYXRlID0gdGhpcy5vblRpbWVVcGRhdGUuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25QbGF5ID0gdGhpcy5vblBsYXkuYmluZCh0aGlzKTtcclxuICAgIHRoaXMub25QYXVzZSA9IHRoaXMub25QYXVzZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy51cGRhdGVQbGF5ZXJTdGF0ZSA9IHRoaXMudXBkYXRlUGxheWVyU3RhdGUuYmluZCh0aGlzKTtcclxuICB9XHJcbiAgb25Mb2FkUmVxdWVzdChsb2FkUmVxdWVzdERhdGEpIHtcclxuICAgIC8vIElmIHRoZSBsb2FkUmVxdWVzdERhdGEgaXMgaW5jb21wbGV0ZSByZXR1cm4gYW4gZXJyb3IgbWVzc2FnZVxyXG4gICAgLy8gaWYgKCFsb2FkUmVxdWVzdERhdGEgfHwgIWxvYWRSZXF1ZXN0RGF0YS5tZWRpYSkge1xyXG4gICAgLy8gICBjb25zdCBlcnJvciA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvckRhdGEoXHJcbiAgICAvLyAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JUeXBlLkxPQURfRkFJTEVEXHJcbiAgICAvLyAgICk7XHJcbiAgICAvLyAgIGVycm9yLnJlYXNvbiA9IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yUmVhc29uLklOVkFMSURfUkVRVUVTVDtcclxuICAgIC8vICAgcmV0dXJuIGVycm9yO1xyXG4gICAgLy8gfVxyXG5cclxuICAgIC8vIC8vIGNoZWNrIGFsbCBjb250ZW50IHNvdXJjZSBmaWVsZHMgZm9yIGFzc2V0IFVSTCBvciBJRFxyXG4gICAgLy8gbGV0IHNvdXJjZSA9XHJcbiAgICAvLyAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50VXJsIHx8XHJcbiAgICAvLyAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5lbnRpdHkgfHxcclxuICAgIC8vICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRJZDtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiVlByZWNlaXZlclwiLCBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudElkKTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiVlByZWNlaXZlcjFcIiwgSGxzLmlzU3VwcG9ydGVkKCkpO1xyXG4gICAgdGhpcy52aWRlb09iamVjdC5maWxlID0gbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRJZDtcclxuICAgIHRoaXMudmlkZW9PYmplY3QuZHVyYXRpb24gPSBsb2FkUmVxdWVzdERhdGEubWVkaWEubWV0YWRhdGEuZHVyYXRpb247XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gbG9hZFJlcXVlc3REYXRhLmN1cnJlbnRUaW1lO1xyXG4gICAgdGhpcy5wbGF5YmFja1JhdGUgPSBsb2FkUmVxdWVzdERhdGEucGxheWJhY2tSYXRlO1xyXG4gICAgdGhpcy5hdXRvcGxheSA9IGxvYWRSZXF1ZXN0RGF0YS5hdXRvcGxheTtcclxuICAgIHRoaXMuYXR0YWNoTWVkaWEoKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gICAgLy8gSWYgdGhlcmUgaXMgbm8gc291cmNlIG9yIGEgbWFsZm9ybWVkIElEIHRoZW4gcmV0dXJuIGFuIGVycm9yLlxyXG4gICAgaWYgKCFzb3VyY2UgfHwgc291cmNlID09IFwiXCIgfHwgIXNvdXJjZS5tYXRjaChJRF9SRUdFWCkpIHtcclxuICAgICAgbGV0IGVycm9yID0gbmV3IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yRGF0YShcclxuICAgICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvclR5cGUuTE9BRF9GQUlMRURcclxuICAgICAgKTtcclxuICAgICAgZXJyb3IucmVhc29uID0gY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JSZWFzb24uSU5WQUxJRF9SRVFVRVNUO1xyXG4gICAgICByZXR1cm4gZXJyb3I7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHNvdXJjZUlkID0gc291cmNlLm1hdGNoKElEX1JFR0VYKVsxXTtcclxuXHJcbiAgICAvLyBBZGQgYnJlYWtzIHRvIHRoZSBtZWRpYSBpbmZvcm1hdGlvbiBhbmQgc2V0IHRoZSBjb250ZW50VXJsXHJcbiAgICByZXR1cm4gYWRkQnJlYWtzKGxvYWRSZXF1ZXN0RGF0YS5tZWRpYSlcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIC8vIElmIHRoZSBzb3VyY2UgaXMgYSB1cmwgdGhhdCBwb2ludHMgdG8gYW4gYXNzZXQgZG9uJ3QgZmV0Y2ggZnJvbSBiYWNrZW5kXHJcbiAgICAgICAgaWYgKHNvdXJjZUlkLmluY2x1ZGVzKFwiLlwiKSkge1xyXG4gICAgICAgICAgY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICAgICAgICBMT0dfUkVDRUlWRVJfVEFHLFxyXG4gICAgICAgICAgICBcIkludGVyY2VwdG9yIHJlY2VpdmVkIGZ1bGwgVVJMXCJcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudFVybCA9IHNvdXJjZTtcclxuICAgICAgICAgIHJldHVybiBsb2FkUmVxdWVzdERhdGE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBGZXRjaCB0aGUgY29udGVudFVybCBpZiBwcm92aWRlZCBhbiBJRCBvciBlbnRpdHkgVVJMXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBjYXN0RGVidWdMb2dnZXIuZGVidWcoTE9HX1JFQ0VJVkVSX1RBRywgXCJJbnRlcmNlcHRvciByZWNlaXZlZCBJRFwiKTtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmZldGNoTWVkaWFCeUlkKHNvdXJjZUlkKS50aGVuKChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBtZXRhZGF0YSA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5HZW5lcmljTWVkaWFNZXRhZGF0YSgpO1xyXG4gICAgICAgICAgICBtZXRhZGF0YS50aXRsZSA9IGl0ZW0udGl0bGU7XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLnN1YnRpdGxlID0gaXRlbS5kZXNjcmlwdGlvbjtcclxuICAgICAgICAgICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRJZCA9IGl0ZW0uc3RyZWFtLmRhc2g7XHJcbiAgICAgICAgICAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50VHlwZSA9IFwiYXBwbGljYXRpb24vZGFzaCt4bWxcIjtcclxuICAgICAgICAgICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLm1ldGFkYXRhID0gbWV0YWRhdGE7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2FkUmVxdWVzdERhdGE7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyb3JNZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgbGV0IGVycm9yID0gbmV3IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yRGF0YShcclxuICAgICAgICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yVHlwZS5MT0FEX0ZBSUxFRFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgZXJyb3IucmVhc29uID0gY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JSZWFzb24uSU5WQUxJRF9SRVFVRVNUO1xyXG4gICAgICAgIGNhc3REZWJ1Z0xvZ2dlci5lcnJvcihMT0dfUkVDRUlWRVJfVEFHLCBlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgIHJldHVybiBlcnJvcjtcclxuICAgICAgfSk7XHJcbiAgfVxyXG4gIGFkZEJyZWFrcyhtZWRpYUluZm9ybWF0aW9uKSB7XHJcbiAgICBjYXN0RGVidWdMb2dnZXIuZGVidWcoXHJcbiAgICAgIExPR19SRUNFSVZFUl9UQUcsXHJcbiAgICAgIFwiYWRkQnJlYWtzOiBcIiArIEpTT04uc3RyaW5naWZ5KG1lZGlhSW5mb3JtYXRpb24pXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIGZldGNoTWVkaWFCeUlkKFwiZmJiX2FkXCIpLnRoZW4oKGNsaXAxKSA9PiB7XHJcbiAgICAgIG1lZGlhSW5mb3JtYXRpb24uYnJlYWtDbGlwcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogXCJmYmJfYWRcIixcclxuICAgICAgICAgIHRpdGxlOiBjbGlwMS50aXRsZSxcclxuICAgICAgICAgIGNvbnRlbnRVcmw6IGNsaXAxLnN0cmVhbS5kYXNoLFxyXG4gICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vZGFzaCt4bWxcIixcclxuICAgICAgICAgIHdoZW5Ta2lwcGFibGU6IDUsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuXHJcbiAgICAgIG1lZGlhSW5mb3JtYXRpb24uYnJlYWtzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBcInByZS1yb2xsXCIsXHJcbiAgICAgICAgICBicmVha0NsaXBJZHM6IFtcImZiYl9hZFwiXSxcclxuICAgICAgICAgIHBvc2l0aW9uOiAwLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZmV0Y2hNZWRpYUJ5SWQoaWQpIHtcclxuICAgIGNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhMT0dfUkVDRUlWRVJfVEFHLCBcImZldGNoaW5nIGlkOiBcIiArIGlkKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKGFjY2VwdCwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGZldGNoKENPTlRFTlRfVVJMKVxyXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgIC50aGVuKChvYmopID0+IHtcclxuICAgICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgaWYgKG9ialtpZF0pIHtcclxuICAgICAgICAgICAgICBhY2NlcHQob2JqW2lkXSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmVqZWN0KGAke2lkfSBub3QgZm91bmQgaW4gcmVwb3NpdG9yeWApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZWplY3QoXCJDb250ZW50IHJlcG9zaXRvcnkgbm90IGZvdW5kLlwiKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUmVjZWl2ZXI7XHJcbiIsImltcG9ydCBTZWVrQmFyIGZyb20gXCIuL3NlZWtiYXJcIjtcclxuaW1wb3J0IFRpbWVyIGZyb20gXCIuL3RpbWVyXCI7XHJcbmNsYXNzIFJlY2VpdmVyQ29udHJvbHMge1xyXG4gIGNvbnN0cnVjdG9yKGlkKSB7XHJcbiAgICB0aGlzLnNlZWtiYXIgPSBuZXcgU2Vla0JhcihcIi5zZWVrYmFyLXByb2dyZXNzXCIpO1xyXG4gICAgdGhpcy50aW1lciA9IG5ldyBUaW1lcihcIi50aW1lclwiKTtcclxuICAgIHRoaXMuY2FzdERlYnVnZ2VyID0gbnVsbDtcclxuICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5zaG93ID0gdHJ1ZTtcclxuICB9XHJcbiAgc2V0Q2FzdERlYnVnZ2VyKGNhc3REZWJ1Z2dlcikge1xyXG4gICAgdGhpcy5jYXN0RGVidWdnZXIgPSBjYXN0RGVidWdnZXI7XHJcbiAgICB0aGlzLnNlZWtiYXIuc2V0Q2FzdERlYnVnZ2VyKHRoaXMuY2FzdERlYnVnZ2VyKTtcclxuICB9XHJcbiAgdXBkYXRlKHN0YXRlKSB7XHJcbiAgICB0aGlzLnNlZWtiYXIuc2V0UHJvZ3Jlc3Moc3RhdGUuY3VycmVuVHRpbWUsIHN0YXRlLmR1cmF0aW9uKTtcclxuICAgIHRoaXMudGltZXIudXBkYXRlKHN0YXRlLmN1cnJlblR0aW1lLCBzdGF0ZS5kdXJhdGlvbik7XHJcbiAgfVxyXG4gIGhpZGVDb250cm9scyh0aW1lKSB7XHJcbiAgICB0aGlzLnNob3cgPSBmYWxzZTtcclxuICAgIHRoaXMuc2hvd0hpZGUodGltZSB8fCA1MDAwKTtcclxuICB9XHJcbiAgc2hvd0NvbnRyb2xzKCkge1xyXG4gICAgdGhpcy5zaG93ID0gdHJ1ZTtcclxuICAgIHRoaXMuc2hvd0hpZGUoMTApO1xyXG4gIH1cclxuICBzaG93SGlkZSh0aW1pbmcpIHtcclxuICAgIC8vIHRoaXMuY2FzdGRlYnVnZ2VyLmRlYnVnKFwic2hvd0hpZGVcIiwgYCR7dGltaW5nfSAke3RoaXMuc2hvd31gKTtcclxuICAgIGlmICh0aGlzLnNob3cpIHtcclxuICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICB9LCB0aW1pbmcpO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUmVjZWl2ZXJDb250cm9scztcclxuIiwiY2xhc3MgU2Vla0JhciB7XHJcbiAgY29uc3RydWN0b3IoaWQpIHtcclxuICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5jYXN0ZGVidWdnZXIgPSBudWxsO1xyXG4gICAgdGhpcy5zaG93ID0gZmFsc2U7XHJcbiAgfVxyXG4gIHNldENhc3REZWJ1Z2dlcihjYXN0ZGVidWdnZXIpIHtcclxuICAgIHRoaXMuY2FzdGRlYnVnZ2VyID0gY2FzdGRlYnVnZ2VyO1xyXG4gIH1cclxuICBzZXRQcm9ncmVzcyh0aW1lLCBkdXJhdGlvbikge1xyXG4gICAgLy8gdGhpcy5jYXN0ZGVidWdnZXIuZGVidWcoXCJlbGVcIiwgSlNPTi5zdHJpbmdpZnkodGhpcy5lbGVtZW50KSk7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGggPSAodGltZSAvIGR1cmF0aW9uKSAqIDEwMCArIFwiJVwiO1xyXG4gICAgLy8gdGhpcy5jYXN0ZGVidWdnZXIuZGVidWcoXCJ3aWR0aFwiLCB0aGlzLmVsZW1lbnQuc3R5bGUud2lkdGgpO1xyXG4gIH1cclxuXHJcbiAgc2hvd0hpZGUodGltaW5nKSB7XHJcbiAgICB0aGlzLmNhc3RkZWJ1Z2dlci5kZWJ1ZyhcInNob3dIaWRlXCIsIGAke3RpbWluZ30gJHt0aGlzLnNob3d9YCk7XHJcbiAgICBpZiAodGhpcy5zaG93KSB7XHJcbiAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnRFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQucGFyZW50RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgIH0sIHRpbWluZyk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZWVrQmFyO1xyXG4iLCJjbGFzcyBUaW1lciB7XHJcbiAgY29uc3RydWN0b3IoaWQpIHtcclxuICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gIH1cclxuICB1cGRhdGUoY3VycmVudFRpbWUsIGR1cmF0aW9uKSB7XHJcbiAgICBsZXQgY3VycmVudE1pbnV0ZXMgPSBNYXRoLmZsb29yKGN1cnJlbnRUaW1lIC8gNjApO1xyXG4gICAgaWYgKGN1cnJlbnRNaW51dGVzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgIGN1cnJlbnRNaW51dGVzID0gXCIwXCIgKyBjdXJyZW50TWludXRlcztcclxuICAgIH1cclxuICAgIGN1cnJlbnRUaW1lID0gY3VycmVudFRpbWUgJSA2MDtcclxuICAgIGxldCBkdXJhdGlvbk1pbnV0ZXMgPSBNYXRoLmZsb29yKGR1cmF0aW9uIC8gNjApO1xyXG4gICAgaWYgKGR1cmF0aW9uTWludXRlcy5sZW5ndGggPT0gMSkge1xyXG4gICAgICBkdXJhdGlvbk1pbnV0ZXMgPSBcIjBcIiArIGR1cmF0aW9uTWludXRlcztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmVsZW1lbnQuaW5uZXJIdG1sID0gYCR7Y3VycmVudE1pbnV0ZXN9OiR7Y3VycmVudFRpbWV9IC8gJHtkdXJhdGlvbk1pbnV0ZXN9OiR7ZHVyYXRpb259YDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFRpbWVyO1xyXG4iXSwibmFtZXMiOlsidnBSZWNlaXZlciIsImlkIiwiY29uZmlnIiwicmVjZWl2ZXIiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJjb250ZXh0IiwicGxheWVyTWFuYWdlciIsImNhc3REZWJ1Z0xvZ2dlciIsImFwcElkIiwidmlkZW8iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwbGF5YmFja0NvbmZpZyIsImNvbnRyb2xzIiwiaGxzIiwidmlkZW9PYmplY3QiLCJ2aWRlb0NvbnRhaW5lciIsInBhcmVudEVsZW1lbnQiLCJwbGF5YmFja1JhdGUiLCJhdXRvcGxheSIsInJlY2VpdmVyQ29udHJvbHMiLCJzZWVrYmFyIiwiZWxlbWVudCIsImNhc3RkZWJ1Z2dlciIsInNob3ciLCJzZXRDYXN0RGVidWdnZXIiLCJzZXRQcm9ncmVzcyIsInRpbWUiLCJkdXJhdGlvbiIsInN0eWxlIiwid2lkdGgiLCJzaG93SGlkZSIsInRpbWluZyIsImRlYnVnIiwiZGlzcGxheSIsInNldFRpbWVvdXQiLCJ0aW1lciIsInVwZGF0ZSIsImN1cnJlbnRUaW1lIiwiY3VycmVudE1pbnV0ZXMiLCJNYXRoIiwiZmxvb3IiLCJsZW5ndGgiLCJkdXJhdGlvbk1pbnV0ZXMiLCJpbm5lckh0bWwiLCJjYXN0RGVidWdnZXIiLCJzdGF0ZSIsImN1cnJlblR0aW1lIiwiaGlkZUNvbnRyb2xzIiwic2hvd0NvbnRyb2xzIiwibWVkaWFNYW5hZ2VyIiwiY2FzdFJlY2VpdmVyTWFuYWdlciIsInN0YXJ0Iiwib25QbGF5IiwicGxheSIsInRoZW4iLCJjYXRjaCIsIm9uUGF1c2UiLCJwYXVzZSIsImFkZFBsYXllckV2ZW50cyIsImFkZEV2ZW50TGlzdGVuZXIiLCJvblRpbWVVcGRhdGUiLCJ1cGRhdGVQbGF5ZXJTdGF0ZSIsImF0dGFjaE1lZGlhIiwiSExTc3VwcG9ydGVkIiwiSGxzIiwiaXNTdXBwb3J0ZWQiLCJKU09OIiwic3RyaW5naWZ5IiwiZmlsZSIsImVuZHNXaXRoIiwic3JjIiwib24iLCJFdmVudHMiLCJNRURJQV9BVFRBQ0hFRCIsInN0YXJ0TGV2ZWwiLCJsb2FkU291cmNlIiwiTUFOSUZFU1RfUEFSU0VEIiwiZXZlbnQiLCJkYXRhIiwiRVJST1IiLCJkZXRhaWxzIiwiZXJyb3IiLCJmYWtlaW5pdCIsImNhc3QiLCJmcmFtZXdvcmsiLCJDYXN0UmVjZWl2ZXJDb250ZXh0IiwiZ2V0SW5zdGFuY2UiLCJnZXRQbGF5ZXJNYW5hZ2VyIiwidHlwZSIsIm1lc3NhZ2UiLCJjb25zb2xlIiwiYmluZE1ldGhvZHMiLCJpbml0Iiwic2V0TG9nZ2VyTGV2ZWwiLCJMb2dnZXJMZXZlbCIsIkRFQlVHIiwic2V0TWVkaWFFbGVtZW50IiwiQ2FzdERlYnVnTG9nZ2VyIiwic2V0RW5hYmxlZCIsImJpbmRJbnRlcmNlcHRvcnMiLCJvblNlZWsiLCJkcmF3QnV0dG9ucyIsImFzc2lnbkJ1dHRvbiIsInVpIiwiQ29udHJvbHNTbG90IiwiU0xPVF9TRUNPTkRBUllfMSIsIkNvbnRyb2xzQnV0dG9uIiwiUVVFVUVfUFJFViIsIlNMT1RfUFJJTUFSWV8xIiwiQ0FQVElPTlMiLCJTTE9UX1BSSU1BUllfMiIsIlNFRUtfRk9SV0FSRF8xNSIsIlNMT1RfU0VDT05EQVJZXzIiLCJRVUVVRV9ORVhUIiwic2V0TWVzc2FnZUludGVyY2VwdG9yIiwibWVzc2FnZXMiLCJNZXNzYWdlVHlwZSIsIkxPQUQiLCJvbkxvYWRSZXF1ZXN0IiwiYmluZCIsIlBMQVkiLCJQQVVTRSIsImxvYWRSZXF1ZXN0RGF0YSIsIm1lZGlhIiwiY29udGVudElkIiwibWV0YWRhdGEiLCJhZGRCcmVha3MiLCJtZWRpYUluZm9ybWF0aW9uIiwiTE9HX1JFQ0VJVkVSX1RBRyIsImZldGNoTWVkaWFCeUlkIiwiY2xpcDEiLCJicmVha0NsaXBzIiwidGl0bGUiLCJjb250ZW50VXJsIiwic3RyZWFtIiwiZGFzaCIsImNvbnRlbnRUeXBlIiwid2hlblNraXBwYWJsZSIsImJyZWFrcyIsImJyZWFrQ2xpcElkcyIsInBvc2l0aW9uIiwiUHJvbWlzZSIsImFjY2VwdCIsInJlamVjdCIsImZldGNoIiwiQ09OVEVOVF9VUkwiLCJyZXNwb25zZSIsImpzb24iLCJvYmoiLCJ3aW5kb3ciXSwic291cmNlUm9vdCI6IiJ9