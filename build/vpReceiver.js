(()=>{"use strict";const t=class{constructor(t,e){this.context=null,this.playerManager=null,this.castDebugLogger=null,this.appId=e.appId,this.video=document.querySelector(t),this.playbackConfig=null,this.controls=null,this.hls=null,this.videoObject=null}start(){this.play()}play(){this.video.play().then((()=>{alert("playing")})).catch((()=>{}))}attachMedia(){vpPlayer.HLSsupported=Hls.isSupported(),this.video.playbackRate=1,this.videoObject.file.endsWith("mp4")?(this.video.src=this.videoObject.file,this.start()):vpPlayer.HLSsupported&&!Utils.isIOS()?(this.hls=new Hls(config),this.hls.attachMedia(this.video),this.hls.on(Hls.Events.MEDIA_ATTACHED,(()=>{this.hls.startLevel=this.videoObject.live?0:Utils.getStartLevel(this.videoObject.duration),this.hls.loadSource(this.videoObject.file),this.seekToLive=!0})),this.hls.on(Hls.Events.MANIFEST_PARSED,((t,e)=>{Utils.isSafari()?(this.video.src=this.videoObject.file,fps_drm.init(this.video,config.fpsCertificateUrl,this.videoObject.assetId)):this.qualityLevels=this.hls.levels,this.start(),this.hls.loadLevel=null!=this.config.quality?Math.min(this.config.quality,this.hls.levels.length-1):-1,this.seekToLive=!0})),this.hls.on(Hls.Events.ERROR,((t,e)=>{if("manifestLoadError"===e.details&&(this.videoContainer.classList.add(cssClasses.effects.hideContent),this.videoContainer.classList.add(cssClasses.effects.showError)),"manifestLoadTimeOut"===e.details&&(this.videoContainer.classList.add(cssClasses.effects.hideContent),this.videoContainer.classList.add(cssClasses.effects.showError)),"manifestParsingError"===e.details&&(this.videoContainer.classList.add(cssClasses.effects.hideContent),this.videoContainer.classList.add(cssClasses.effects.showError)),"levelLoadError"===e.details&&this.removeLevel(e.context.level),"fragLoadError"===e.details&&(this.fragErrorCount++,0==e.frag.sn&&(this.failedToLoadFirstFragment=!0)),this.levelHasMissingFragments()&&(this.fragErrorCount=0,this.removeLevel(e.frag.level),this.hls.loadLevel=-1,console.log("Network error encountered")),this.failedToLoadFirstFragment&&(this.failedToLoadFirstFragment=!1,this.removeLevel(e.frag.level),this.hls.loadLevel=-1,this.onPlay(),console.log("Network error encountered")),e.fatal)switch(e.type){case Hls.ErrorTypes.NETWORK_ERROR:console.log("fatal network error encountered"),this.hls.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.log("fatal media error encountered"),this.hls.recoverMediaError();break;default:this.hls.destroy()}}))):this.video.canPlayType("application/vnd.apple.mpegurl")&&(this.video.src=this.videoObject.file,Utils.isIOS()&&fps_drm.init(this.video,config.fpsCertificateUrl,this.videoObject.assetId),this.video.playsInline=!0,this.start())}fakeinit(){const t=cast.framework.CastReceiverContext.getInstance();t.getPlayerManager(),t.start()}init(){this.context=cast.framework.CastReceiverContext.getInstance(),this.playerManager=this.context.getPlayerManager(),this.castDebugLogger=cast.debug.CastDebugLogger.getInstance()}drawButtons(){this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_1,cast.framework.ui.ControlsButton.QUEUE_PREV),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_1,cast.framework.ui.ControlsButton.CAPTIONS),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_2,cast.framework.ui.ControlsButton.SEEK_FORWARD_15),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_2,cast.framework.ui.ControlsButton.QUEUE_NEXT)}bindInterceptors(){this.playerManager.setMessageInterceptor(cast.framework.messages.MessageTyep.LOAD,this.onLoadRequest)}bindMethodd(){this.bindInterceptors=this.bindInterceptors.bind(this),this.init=this.init.bind(this),this.drawButtons=this.drawButtons.bind(this),this.onLoadRequest=this.onLoadRequest.bind(this),this.attachMedia=this.attachMedia.bind(this)}onLoadRequest(t){if(castDebugLogger.debug(LOG_RECEIVER_TAG,`loadRequestData: ${JSON.stringify(t)}`),!t||!t.media){const t=new cast.framework.messages.ErrorData(cast.framework.messages.ErrorType.LOAD_FAILED);return t.reason=cast.framework.messages.ErrorReason.INVALID_REQUEST,t}let e=t.media.contentUrl||t.media.entity||t.media.contentId;return this.videoObject.file=e,this.attachMedia(),t}addBreaks(t){return castDebugLogger.debug(LOG_RECEIVER_TAG,"addBreaks: "+JSON.stringify(t)),fetchMediaById("fbb_ad").then((e=>{t.breakClips=[{id:"fbb_ad",title:e.title,contentUrl:e.stream.dash,contentType:"application/dash+xml",whenSkippable:5}],t.breaks=[{id:"pre-roll",breakClipIds:["fbb_ad"],position:0}]}))}fetchMediaById(t){return castDebugLogger.debug(LOG_RECEIVER_TAG,"fetching id: "+t),new Promise(((e,s)=>{fetch(CONTENT_URL).then((t=>t.json())).then((i=>{i?i[t]?e(i[t]):s(`${t} not found in repository`):s("Content repository not found.")}))}))}};vpPlayer.HLSsupported=!1,window.vpReceiver=function(e,s){new t(e,s).fakeinit()}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQ2JSLFdBQVlNLEVBQU1HLE9BQU9DLEtBQ3pCQyxZQUFhLHVCQUNiQyxjQUFlLElBSW5CUixFQUFpQlMsT0FBUyxDQUN4QixDQUNFM0ksR0FBSSxXQUNKNEksYUFBYyxDQUFDLFVBQ2ZDLFNBQVUsT0FLbEJWLGVBQWVuSSxHQUdiLE9BRkFLLGdCQUFnQnFGLE1BQU13QixpQkFBa0IsZ0JBQWtCbEgsR0FFbkQsSUFBSThJLFNBQVEsQ0FBQ0MsRUFBUUMsS0FDMUJDLE1BQU1DLGFBQ0hsSSxNQUFNbUksR0FBYUEsRUFBU0MsU0FDNUJwSSxNQUFNcUksSUFDREEsRUFDRUEsRUFBSXJKLEdBQ04rSSxFQUFPTSxFQUFJckosSUFFWGdKLEVBQVEsR0FBRWhKLDZCQUdaZ0osRUFBTyx5Q0M5U25CNUgsU0FBU0MsY0FBZSxFQVF4QmlJLE9BQU9DLFdBTlAsU0FBb0J2SixFQUFJQyxHQUNMLElBQUl1SixFQUFTeEosRUFBSUMsR0FFekJtRixhIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdnAtcmVjZWl2ZXIvLi9zcmMvanMvbW9kZWxzL3JlY2VpdmVyLmpzIiwid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL3ZwUmVjZWl2ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGhsc2NvbmZpZyBmcm9tIFwiLi4vY29uZmlnL2hsc0NvbmZpZ1wiO1xyXG5jbGFzcyBSZWNlaXZlciB7XHJcbiAgY29uc3RydWN0b3IoaWQsIGNvbmZpZykge1xyXG4gICAgdGhpcy5jb250ZXh0ID0gbnVsbDtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlciA9IG51bGw7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlciA9IG51bGw7XHJcbiAgICB0aGlzLmFwcElkID0gY29uZmlnLmFwcElkO1xyXG4gICAgdGhpcy52aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5wbGF5YmFja0NvbmZpZyA9IG51bGw7XHJcbiAgICB0aGlzLmNvbnRyb2xzID0gbnVsbDtcclxuICAgIHRoaXMuaGxzID0gbnVsbDtcclxuICAgIHRoaXMudmlkZW9PYmplY3QgPSBudWxsO1xyXG4gIH1cclxuICBzdGFydCgpIHtcclxuICAgIHRoaXMucGxheSgpO1xyXG4gIH1cclxuXHJcbiAgcGxheSgpIHtcclxuICAgIHRoaXMudmlkZW9cclxuICAgICAgLnBsYXkoKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgYWxlcnQoXCJwbGF5aW5nXCIpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKCkgPT4ge30pO1xyXG4gIH1cclxuICBhdHRhY2hNZWRpYSgpIHtcclxuICAgIHZwUGxheWVyLkhMU3N1cHBvcnRlZCA9IEhscy5pc1N1cHBvcnRlZCgpO1xyXG4gICAgdGhpcy52aWRlby5wbGF5YmFja1JhdGUgPSAxO1xyXG5cclxuICAgIGlmICh0aGlzLnZpZGVvT2JqZWN0LmZpbGUuZW5kc1dpdGgoXCJtcDRcIikpIHtcclxuICAgICAgdGhpcy52aWRlby5zcmMgPSB0aGlzLnZpZGVvT2JqZWN0LmZpbGU7XHJcbiAgICAgIHRoaXMuc3RhcnQoKTtcclxuICAgIH0gZWxzZSBpZiAodnBQbGF5ZXIuSExTc3VwcG9ydGVkICYmICFVdGlscy5pc0lPUygpKSB7XHJcbiAgICAgIHRoaXMuaGxzID0gbmV3IEhscyhjb25maWcpO1xyXG4gICAgICB0aGlzLmhscy5hdHRhY2hNZWRpYSh0aGlzLnZpZGVvKTtcclxuXHJcbiAgICAgIHRoaXMuaGxzLm9uKEhscy5FdmVudHMuTUVESUFfQVRUQUNIRUQsICgpID0+IHtcclxuICAgICAgICB0aGlzLmhscy5zdGFydExldmVsID0gdGhpcy52aWRlb09iamVjdC5saXZlXHJcbiAgICAgICAgICA/IDBcclxuICAgICAgICAgIDogVXRpbHMuZ2V0U3RhcnRMZXZlbCh0aGlzLnZpZGVvT2JqZWN0LmR1cmF0aW9uKTtcclxuICAgICAgICB0aGlzLmhscy5sb2FkU291cmNlKHRoaXMudmlkZW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgdGhpcy5zZWVrVG9MaXZlID0gdHJ1ZTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLmhscy5vbihIbHMuRXZlbnRzLk1BTklGRVNUX1BBUlNFRCwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgaWYgKFV0aWxzLmlzU2FmYXJpKCkpIHtcclxuICAgICAgICAgIHRoaXMudmlkZW8uc3JjID0gdGhpcy52aWRlb09iamVjdC5maWxlO1xyXG4gICAgICAgICAgZnBzX2RybS5pbml0KFxyXG4gICAgICAgICAgICB0aGlzLnZpZGVvLFxyXG4gICAgICAgICAgICBjb25maWcuZnBzQ2VydGlmaWNhdGVVcmwsXHJcbiAgICAgICAgICAgIHRoaXMudmlkZW9PYmplY3QuYXNzZXRJZFxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhpcy5xdWFsaXR5TGV2ZWxzID0gdGhpcy5obHMubGV2ZWxzO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN0YXJ0KCk7XHJcblxyXG4gICAgICAgIHRoaXMuaGxzLmxvYWRMZXZlbCA9XHJcbiAgICAgICAgICB0aGlzLmNvbmZpZy5xdWFsaXR5ICE9IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICA/IE1hdGgubWluKHRoaXMuY29uZmlnLnF1YWxpdHksIHRoaXMuaGxzLmxldmVscy5sZW5ndGggLSAxKVxyXG4gICAgICAgICAgICA6IC0xO1xyXG4gICAgICAgIHRoaXMuc2Vla1RvTGl2ZSA9IHRydWU7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgdGhpcy5obHMub24oSGxzLkV2ZW50cy5FUlJPUiwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgICAgaWYgKGRhdGEuZGV0YWlscyA9PT0gXCJtYW5pZmVzdExvYWRFcnJvclwiKSB7XHJcbiAgICAgICAgICB0aGlzLnZpZGVvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLmhpZGVDb250ZW50KTtcclxuICAgICAgICAgIHRoaXMudmlkZW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuc2hvd0Vycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwibWFuaWZlc3RMb2FkVGltZU91dFwiKSB7XHJcbiAgICAgICAgICB0aGlzLnZpZGVvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLmhpZGVDb250ZW50KTtcclxuICAgICAgICAgIHRoaXMudmlkZW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuc2hvd0Vycm9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwibWFuaWZlc3RQYXJzaW5nRXJyb3JcIikge1xyXG4gICAgICAgICAgdGhpcy52aWRlb0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNzc0NsYXNzZXMuZWZmZWN0cy5oaWRlQ29udGVudCk7XHJcbiAgICAgICAgICB0aGlzLnZpZGVvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLnNob3dFcnJvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGF0YS5kZXRhaWxzID09PSBcImxldmVsTG9hZEVycm9yXCIpIHtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlTGV2ZWwoZGF0YS5jb250ZXh0LmxldmVsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwiZnJhZ0xvYWRFcnJvclwiKSB7XHJcbiAgICAgICAgICB0aGlzLmZyYWdFcnJvckNvdW50Kys7XHJcbiAgICAgICAgICAvLyBzbiByZWZlcmVzIHRvIHNlcXVlbmNlIG51bWJlclxyXG4gICAgICAgICAgaWYgKGRhdGEuZnJhZy5zbiA9PSAwKSB0aGlzLmZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubGV2ZWxIYXNNaXNzaW5nRnJhZ21lbnRzKCkpIHtcclxuICAgICAgICAgIHRoaXMuZnJhZ0Vycm9yQ291bnQgPSAwO1xyXG4gICAgICAgICAgdGhpcy5yZW1vdmVMZXZlbChkYXRhLmZyYWcubGV2ZWwpO1xyXG4gICAgICAgICAgdGhpcy5obHMubG9hZExldmVsID0gLTE7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIk5ldHdvcmsgZXJyb3IgZW5jb3VudGVyZWRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5mYWlsZWRUb0xvYWRGaXJzdEZyYWdtZW50KSB7XHJcbiAgICAgICAgICB0aGlzLmZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQgPSBmYWxzZTtcclxuICAgICAgICAgIHRoaXMucmVtb3ZlTGV2ZWwoZGF0YS5mcmFnLmxldmVsKTtcclxuICAgICAgICAgIHRoaXMuaGxzLmxvYWRMZXZlbCA9IC0xO1xyXG4gICAgICAgICAgdGhpcy5vblBsYXkoKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiTmV0d29yayBlcnJvciBlbmNvdW50ZXJlZFwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghZGF0YS5mYXRhbCkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcclxuICAgICAgICAgIGNhc2UgSGxzLkVycm9yVHlwZXMuTkVUV09SS19FUlJPUjpcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJmYXRhbCBuZXR3b3JrIGVycm9yIGVuY291bnRlcmVkXCIpO1xyXG4gICAgICAgICAgICB0aGlzLmhscy5zdGFydExvYWQoKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlIEhscy5FcnJvclR5cGVzLk1FRElBX0VSUk9SOlxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImZhdGFsIG1lZGlhIGVycm9yIGVuY291bnRlcmVkXCIpO1xyXG4gICAgICAgICAgICB0aGlzLmhscy5yZWNvdmVyTWVkaWFFcnJvcigpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHRoaXMuaGxzLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy52aWRlby5jYW5QbGF5VHlwZShcImFwcGxpY2F0aW9uL3ZuZC5hcHBsZS5tcGVndXJsXCIpKSB7XHJcbiAgICAgIHRoaXMudmlkZW8uc3JjID0gdGhpcy52aWRlb09iamVjdC5maWxlO1xyXG4gICAgICBpZiAoVXRpbHMuaXNJT1MoKSkge1xyXG4gICAgICAgIGZwc19kcm0uaW5pdChcclxuICAgICAgICAgIHRoaXMudmlkZW8sXHJcbiAgICAgICAgICBjb25maWcuZnBzQ2VydGlmaWNhdGVVcmwsXHJcbiAgICAgICAgICB0aGlzLnZpZGVvT2JqZWN0LmFzc2V0SWRcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMudmlkZW8ucGxheXNJbmxpbmUgPSB0cnVlO1xyXG4gICAgICB0aGlzLnN0YXJ0KCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGZha2Vpbml0KCkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IGNhc3QuZnJhbWV3b3JrLkNhc3RSZWNlaXZlckNvbnRleHQuZ2V0SW5zdGFuY2UoKTtcclxuICAgIGNvbnN0IHBsYXllck1hbmFnZXIgPSBjb250ZXh0LmdldFBsYXllck1hbmFnZXIoKTtcclxuICAgIGNvbnRleHQuc3RhcnQoKTtcclxuICB9XHJcbiAgaW5pdCgpIHtcclxuICAgIHRoaXMuY29udGV4dCA9IGNhc3QuZnJhbWV3b3JrLkNhc3RSZWNlaXZlckNvbnRleHQuZ2V0SW5zdGFuY2UoKTtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlciA9IHRoaXMuY29udGV4dC5nZXRQbGF5ZXJNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlciA9IGNhc3QuZGVidWcuQ2FzdERlYnVnTG9nZ2VyLmdldEluc3RhbmNlKCk7XHJcbiAgICAvLyB0aGlzLnBsYXliYWNrQ29uZmlnLmF1dG9SZXN1bWVEdXJhdGlvbiA9IDU7XHJcbiAgICAvLyB0aGlzLmNhc3REZWJ1Z0xvZ2dlci5pbmZvKFxyXG4gICAgLy8gICBMT0dfUkVDRUlWRVJfVEFHLFxyXG4gICAgLy8gICBgYXV0b1Jlc3VtZUR1cmF0aW9uIHNldCB0bzogJHtwbGF5YmFja0NvbmZpZy5hdXRvUmVzdW1lRHVyYXRpb259YFxyXG4gICAgLy8gKTtcclxuICAgIC8vIHRoaXMuY29udHJvbHMuY2xlYXJEZWZhdWx0U2xvdEFzc2lnbm1lbnRzKCk7XHJcbiAgICAvLyB0aGlzLmRyYXdCdXR0b25zKCk7XHJcblxyXG4gICAgLy8gY29udGV4dC5zdGFydCh7XHJcbiAgICAvLyAgIHF1ZXVlOiBuZXcgQ2FzdFF1ZXVlKCksXHJcbiAgICAvLyAgIHBsYXliYWNrQ29uZmlnOiB0aGlzLnBsYXliYWNrQ29uZmlnLFxyXG4gICAgLy8gICBzdXBwb3J0ZWRDb21tYW5kczpcclxuICAgIC8vICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5Db21tYW5kLkFMTF9CQVNJQ19NRURJQSB8XHJcbiAgICAvLyAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuQ29tbWFuZC5RVUVVRV9QUkVWIHxcclxuICAgIC8vICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5Db21tYW5kLlFVRVVFX05FWFQgfFxyXG4gICAgLy8gICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkNvbW1hbmQuU1RSRUFNX1RSQU5TRkVSLFxyXG4gICAgLy8gfSk7XHJcbiAgfVxyXG4gIGRyYXdCdXR0b25zKCkge1xyXG4gICAgdGhpcy5jb250cm9scy5hc3NpZ25CdXR0b24oXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzU2xvdC5TTE9UX1NFQ09OREFSWV8xLFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc0J1dHRvbi5RVUVVRV9QUkVWXHJcbiAgICApO1xyXG4gICAgdGhpcy5jb250cm9scy5hc3NpZ25CdXR0b24oXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzU2xvdC5TTE9UX1BSSU1BUllfMSxcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNCdXR0b24uQ0FQVElPTlNcclxuICAgICk7XHJcbiAgICB0aGlzLmNvbnRyb2xzLmFzc2lnbkJ1dHRvbihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNTbG90LlNMT1RfUFJJTUFSWV8yLFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc0J1dHRvbi5TRUVLX0ZPUldBUkRfMTVcclxuICAgICk7XHJcbiAgICB0aGlzLmNvbnRyb2xzLmFzc2lnbkJ1dHRvbihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNTbG90LlNMT1RfU0VDT05EQVJZXzIsXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzQnV0dG9uLlFVRVVFX05FWFRcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBiaW5kSW50ZXJjZXB0b3JzKCkge1xyXG4gICAgdGhpcy5wbGF5ZXJNYW5hZ2VyLnNldE1lc3NhZ2VJbnRlcmNlcHRvcihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuTWVzc2FnZVR5ZXAuTE9BRCxcclxuICAgICAgdGhpcy5vbkxvYWRSZXF1ZXN0XHJcbiAgICApO1xyXG4gIH1cclxuICBiaW5kTWV0aG9kZCgpIHtcclxuICAgIHRoaXMuYmluZEludGVyY2VwdG9ycyA9IHRoaXMuYmluZEludGVyY2VwdG9ycy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5pbml0ID0gdGhpcy5pbml0LmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmRyYXdCdXR0b25zID0gdGhpcy5kcmF3QnV0dG9ucy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vbkxvYWRSZXF1ZXN0ID0gdGhpcy5vbkxvYWRSZXF1ZXN0LmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLmF0dGFjaE1lZGlhID0gdGhpcy5hdHRhY2hNZWRpYS5iaW5kKHRoaXMpO1xyXG4gIH1cclxuICBvbkxvYWRSZXF1ZXN0KGxvYWRSZXF1ZXN0RGF0YSkge1xyXG4gICAgY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICBMT0dfUkVDRUlWRVJfVEFHLFxyXG4gICAgICBgbG9hZFJlcXVlc3REYXRhOiAke0pTT04uc3RyaW5naWZ5KGxvYWRSZXF1ZXN0RGF0YSl9YFxyXG4gICAgKTtcclxuXHJcbiAgICAvLyBJZiB0aGUgbG9hZFJlcXVlc3REYXRhIGlzIGluY29tcGxldGUgcmV0dXJuIGFuIGVycm9yIG1lc3NhZ2VcclxuICAgIGlmICghbG9hZFJlcXVlc3REYXRhIHx8ICFsb2FkUmVxdWVzdERhdGEubWVkaWEpIHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JEYXRhKFxyXG4gICAgICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yVHlwZS5MT0FEX0ZBSUxFRFxyXG4gICAgICApO1xyXG4gICAgICBlcnJvci5yZWFzb24gPSBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvclJlYXNvbi5JTlZBTElEX1JFUVVFU1Q7XHJcbiAgICAgIHJldHVybiBlcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBjaGVjayBhbGwgY29udGVudCBzb3VyY2UgZmllbGRzIGZvciBhc3NldCBVUkwgb3IgSURcclxuICAgIGxldCBzb3VyY2UgPVxyXG4gICAgICBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudFVybCB8fFxyXG4gICAgICBsb2FkUmVxdWVzdERhdGEubWVkaWEuZW50aXR5IHx8XHJcbiAgICAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50SWQ7XHJcblxyXG4gICAgdGhpcy52aWRlb09iamVjdC5maWxlID0gc291cmNlO1xyXG4gICAgdGhpcy5hdHRhY2hNZWRpYSgpO1xyXG4gICAgcmV0dXJuIGxvYWRSZXF1ZXN0RGF0YTtcclxuICAgIC8vIElmIHRoZXJlIGlzIG5vIHNvdXJjZSBvciBhIG1hbGZvcm1lZCBJRCB0aGVuIHJldHVybiBhbiBlcnJvci5cclxuICAgIGlmICghc291cmNlIHx8IHNvdXJjZSA9PSBcIlwiIHx8ICFzb3VyY2UubWF0Y2goSURfUkVHRVgpKSB7XHJcbiAgICAgIGxldCBlcnJvciA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvckRhdGEoXHJcbiAgICAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JUeXBlLkxPQURfRkFJTEVEXHJcbiAgICAgICk7XHJcbiAgICAgIGVycm9yLnJlYXNvbiA9IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yUmVhc29uLklOVkFMSURfUkVRVUVTVDtcclxuICAgICAgcmV0dXJuIGVycm9yO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBzb3VyY2VJZCA9IHNvdXJjZS5tYXRjaChJRF9SRUdFWClbMV07XHJcblxyXG4gICAgLy8gQWRkIGJyZWFrcyB0byB0aGUgbWVkaWEgaW5mb3JtYXRpb24gYW5kIHNldCB0aGUgY29udGVudFVybFxyXG4gICAgcmV0dXJuIGFkZEJyZWFrcyhsb2FkUmVxdWVzdERhdGEubWVkaWEpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAvLyBJZiB0aGUgc291cmNlIGlzIGEgdXJsIHRoYXQgcG9pbnRzIHRvIGFuIGFzc2V0IGRvbid0IGZldGNoIGZyb20gYmFja2VuZFxyXG4gICAgICAgIGlmIChzb3VyY2VJZC5pbmNsdWRlcyhcIi5cIikpIHtcclxuICAgICAgICAgIGNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcclxuICAgICAgICAgICAgTE9HX1JFQ0VJVkVSX1RBRyxcclxuICAgICAgICAgICAgXCJJbnRlcmNlcHRvciByZWNlaXZlZCBmdWxsIFVSTFwiXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRVcmwgPSBzb3VyY2U7XHJcbiAgICAgICAgICByZXR1cm4gbG9hZFJlcXVlc3REYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRmV0Y2ggdGhlIGNvbnRlbnRVcmwgaWYgcHJvdmlkZWQgYW4gSUQgb3IgZW50aXR5IFVSTFxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgY2FzdERlYnVnTG9nZ2VyLmRlYnVnKExPR19SRUNFSVZFUl9UQUcsIFwiSW50ZXJjZXB0b3IgcmVjZWl2ZWQgSURcIik7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5mZXRjaE1lZGlhQnlJZChzb3VyY2VJZCkudGhlbigoaXRlbSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbWV0YWRhdGEgPSBuZXcgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuR2VuZXJpY01lZGlhTWV0YWRhdGEoKTtcclxuICAgICAgICAgICAgbWV0YWRhdGEudGl0bGUgPSBpdGVtLnRpdGxlO1xyXG4gICAgICAgICAgICBtZXRhZGF0YS5zdWJ0aXRsZSA9IGl0ZW0uZGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50SWQgPSBpdGVtLnN0cmVhbS5kYXNoO1xyXG4gICAgICAgICAgICBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudFR5cGUgPSBcImFwcGxpY2F0aW9uL2Rhc2greG1sXCI7XHJcbiAgICAgICAgICAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5tZXRhZGF0YSA9IG1ldGFkYXRhO1xyXG4gICAgICAgICAgICByZXR1cm4gbG9hZFJlcXVlc3REYXRhO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgICAgIGxldCBlcnJvciA9IG5ldyBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvckRhdGEoXHJcbiAgICAgICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvclR5cGUuTE9BRF9GQUlMRURcclxuICAgICAgICApO1xyXG4gICAgICAgIGVycm9yLnJlYXNvbiA9IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yUmVhc29uLklOVkFMSURfUkVRVUVTVDtcclxuICAgICAgICBjYXN0RGVidWdMb2dnZXIuZXJyb3IoTE9HX1JFQ0VJVkVSX1RBRywgZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICByZXR1cm4gZXJyb3I7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuICBhZGRCcmVha3MobWVkaWFJbmZvcm1hdGlvbikge1xyXG4gICAgY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICBMT0dfUkVDRUlWRVJfVEFHLFxyXG4gICAgICBcImFkZEJyZWFrczogXCIgKyBKU09OLnN0cmluZ2lmeShtZWRpYUluZm9ybWF0aW9uKVxyXG4gICAgKTtcclxuICAgIHJldHVybiBmZXRjaE1lZGlhQnlJZChcImZiYl9hZFwiKS50aGVuKChjbGlwMSkgPT4ge1xyXG4gICAgICBtZWRpYUluZm9ybWF0aW9uLmJyZWFrQ2xpcHMgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6IFwiZmJiX2FkXCIsXHJcbiAgICAgICAgICB0aXRsZTogY2xpcDEudGl0bGUsXHJcbiAgICAgICAgICBjb250ZW50VXJsOiBjbGlwMS5zdHJlYW0uZGFzaCxcclxuICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2Rhc2greG1sXCIsXHJcbiAgICAgICAgICB3aGVuU2tpcHBhYmxlOiA1LFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtZWRpYUluZm9ybWF0aW9uLmJyZWFrcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBpZDogXCJwcmUtcm9sbFwiLFxyXG4gICAgICAgICAgYnJlYWtDbGlwSWRzOiBbXCJmYmJfYWRcIl0sXHJcbiAgICAgICAgICBwb3NpdGlvbjogMCxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGZldGNoTWVkaWFCeUlkKGlkKSB7XHJcbiAgICBjYXN0RGVidWdMb2dnZXIuZGVidWcoTE9HX1JFQ0VJVkVSX1RBRywgXCJmZXRjaGluZyBpZDogXCIgKyBpZCk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChhY2NlcHQsIHJlamVjdCkgPT4ge1xyXG4gICAgICBmZXRjaChDT05URU5UX1VSTClcclxuICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAudGhlbigob2JqKSA9PiB7XHJcbiAgICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmpbaWRdKSB7XHJcbiAgICAgICAgICAgICAgYWNjZXB0KG9ialtpZF0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJlamVjdChgJHtpZH0gbm90IGZvdW5kIGluIHJlcG9zaXRvcnlgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVqZWN0KFwiQ29udGVudCByZXBvc2l0b3J5IG5vdCBmb3VuZC5cIik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlY2VpdmVyO1xyXG4iLCJpbXBvcnQgUmVjZWl2ZXIgZnJvbSBcIi4vbW9kZWxzL3JlY2VpdmVyXCI7XHJcblxyXG4vL2EgYm9vbGVhbiB0ZWxsaW5nIHdoZXRoZXIgSExTIGlzIHN1cHBvcnRlZCBpbiB0aGUgYnJvd3NlclxyXG52cFBsYXllci5ITFNzdXBwb3J0ZWQgPSBmYWxzZTtcclxuXHJcbmZ1bmN0aW9uIHZwUmVjZWl2ZXIoaWQsIGNvbmZpZykge1xyXG4gIGNvbnN0IHJlY2VpdmVyID0gbmV3IFJlY2VpdmVyKGlkLCBjb25maWcpO1xyXG5cclxuICByZWNlaXZlci5mYWtlaW5pdCgpO1xyXG59XHJcblxyXG53aW5kb3cudnBSZWNlaXZlciA9IHZwUmVjZWl2ZXI7XHJcbiJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsImlkIiwiY29uZmlnIiwidGhpcyIsImNvbnRleHQiLCJwbGF5ZXJNYW5hZ2VyIiwiY2FzdERlYnVnTG9nZ2VyIiwiYXBwSWQiLCJ2aWRlbyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInBsYXliYWNrQ29uZmlnIiwiY29udHJvbHMiLCJobHMiLCJ2aWRlb09iamVjdCIsInN0YXJ0IiwicGxheSIsInRoZW4iLCJhbGVydCIsImNhdGNoIiwiYXR0YWNoTWVkaWEiLCJ2cFBsYXllciIsIkhMU3N1cHBvcnRlZCIsIkhscyIsImlzU3VwcG9ydGVkIiwicGxheWJhY2tSYXRlIiwiZmlsZSIsImVuZHNXaXRoIiwic3JjIiwiVXRpbHMiLCJpc0lPUyIsIm9uIiwiRXZlbnRzIiwiTUVESUFfQVRUQUNIRUQiLCJzdGFydExldmVsIiwibGl2ZSIsImdldFN0YXJ0TGV2ZWwiLCJkdXJhdGlvbiIsImxvYWRTb3VyY2UiLCJzZWVrVG9MaXZlIiwiTUFOSUZFU1RfUEFSU0VEIiwiZXZlbnQiLCJkYXRhIiwiaXNTYWZhcmkiLCJmcHNfZHJtIiwiaW5pdCIsImZwc0NlcnRpZmljYXRlVXJsIiwiYXNzZXRJZCIsInF1YWxpdHlMZXZlbHMiLCJsZXZlbHMiLCJsb2FkTGV2ZWwiLCJ1bmRlZmluZWQiLCJxdWFsaXR5IiwiTWF0aCIsIm1pbiIsImxlbmd0aCIsIkVSUk9SIiwiZGV0YWlscyIsInZpZGVvQ29udGFpbmVyIiwiY2xhc3NMaXN0IiwiYWRkIiwiY3NzQ2xhc3NlcyIsImVmZmVjdHMiLCJoaWRlQ29udGVudCIsInNob3dFcnJvciIsInJlbW92ZUxldmVsIiwibGV2ZWwiLCJmcmFnRXJyb3JDb3VudCIsImZyYWciLCJzbiIsImZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQiLCJsZXZlbEhhc01pc3NpbmdGcmFnbWVudHMiLCJjb25zb2xlIiwibG9nIiwib25QbGF5IiwiZmF0YWwiLCJ0eXBlIiwiRXJyb3JUeXBlcyIsIk5FVFdPUktfRVJST1IiLCJzdGFydExvYWQiLCJNRURJQV9FUlJPUiIsInJlY292ZXJNZWRpYUVycm9yIiwiZGVzdHJveSIsImNhblBsYXlUeXBlIiwicGxheXNJbmxpbmUiLCJmYWtlaW5pdCIsImNhc3QiLCJmcmFtZXdvcmsiLCJDYXN0UmVjZWl2ZXJDb250ZXh0IiwiZ2V0SW5zdGFuY2UiLCJnZXRQbGF5ZXJNYW5hZ2VyIiwiZGVidWciLCJDYXN0RGVidWdMb2dnZXIiLCJkcmF3QnV0dG9ucyIsImFzc2lnbkJ1dHRvbiIsInVpIiwiQ29udHJvbHNTbG90IiwiU0xPVF9TRUNPTkRBUllfMSIsIkNvbnRyb2xzQnV0dG9uIiwiUVVFVUVfUFJFViIsIlNMT1RfUFJJTUFSWV8xIiwiQ0FQVElPTlMiLCJTTE9UX1BSSU1BUllfMiIsIlNFRUtfRk9SV0FSRF8xNSIsIlNMT1RfU0VDT05EQVJZXzIiLCJRVUVVRV9ORVhUIiwiYmluZEludGVyY2VwdG9ycyIsInNldE1lc3NhZ2VJbnRlcmNlcHRvciIsIm1lc3NhZ2VzIiwiTWVzc2FnZVR5ZXAiLCJMT0FEIiwib25Mb2FkUmVxdWVzdCIsImJpbmRNZXRob2RkIiwiYmluZCIsImxvYWRSZXF1ZXN0RGF0YSIsIkxPR19SRUNFSVZFUl9UQUciLCJKU09OIiwic3RyaW5naWZ5IiwibWVkaWEiLCJlcnJvciIsIkVycm9yRGF0YSIsIkVycm9yVHlwZSIsIkxPQURfRkFJTEVEIiwicmVhc29uIiwiRXJyb3JSZWFzb24iLCJJTlZBTElEX1JFUVVFU1QiLCJzb3VyY2UiLCJjb250ZW50VXJsIiwiZW50aXR5IiwiY29udGVudElkIiwiYWRkQnJlYWtzIiwibWVkaWFJbmZvcm1hdGlvbiIsImZldGNoTWVkaWFCeUlkIiwiY2xpcDEiLCJicmVha0NsaXBzIiwidGl0bGUiLCJzdHJlYW0iLCJkYXNoIiwiY29udGVudFR5cGUiLCJ3aGVuU2tpcHBhYmxlIiwiYnJlYWtzIiwiYnJlYWtDbGlwSWRzIiwicG9zaXRpb24iLCJQcm9taXNlIiwiYWNjZXB0IiwicmVqZWN0IiwiZmV0Y2giLCJDT05URU5UX1VSTCIsInJlc3BvbnNlIiwianNvbiIsIm9iaiIsIndpbmRvdyIsInZwUmVjZWl2ZXIiLCJSZWNlaXZlciJdLCJzb3VyY2VSb290IjoiIn0=